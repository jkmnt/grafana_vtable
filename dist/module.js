define(["emotion","@grafana/ui","@grafana/data","react","@grafana/runtime","moment"],(function(n,e,t,o,r,i){return function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/",t(t.s=6)}([function(e,t){e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=t},function(n,e){n.exports=o},function(n,e){n.exports=r},function(n,e){n.exports=i},function(n,e,t){"use strict";t.r(e);var o=function(){return(o=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};function r(n,e,t,o){return new(t||(t=Promise))((function(r,i){function a(n){try{d(o.next(n))}catch(n){i(n)}}function l(n){try{d(o.throw(n))}catch(n){i(n)}}function d(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,l)}d((o=o.apply(n,e||[])).next())}))}function i(n,e){var t,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(n,a)}catch(n){i=[6,n],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function a(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,r,i=t.call(n),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(n){r={error:n}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(r)throw r.error}}return a}function l(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(a(arguments[e]));return n}function d(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var s=t(3),u=t.n(s),c=t(2),f=t(1),p=t(5),g=t.n(p),v=t(4);function b(n,e,t){var o=Array(e).fill(t);if(!n||!n.length)return o;for(var r=0;r<e;r++){var i=n[r];i&&i>0&&(o[r]=i+"px")}return o}function m(n,e){var t,o;void 0===e&&(e={});var r=[],i=null!==(o=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==o?o:0,a=0;n.forEach((function(n){if(n.label){var e=u.a.createElement("div",{key:n.label.key,style:{"grid-column":"1 / -1"}},n.label);r.push(e),a+=1}n.fields.forEach((function(n){return r.push.apply(r,l(n.values))})),a+=n.fields.length}));var d=b(e.colws,i,"minmax(max-content, 1fr)"),s=b(e.rowhs,a,"max-content");return{style:{display:"grid","grid-template-columns":d.join(" "),"grid-template-rows":s.join(" ")},children:r}}function h(n,e){var t,r;void 0===e&&(e={});var i=[],a=n.find((function(n){return n.label})),d=null!==(r=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==r?r:0;if(a){d+=1;var s=1;n.forEach((function(n){var e,t={"grid-row":"1 / 2","grid-column":s+" / span "+n.fields.length},r=n.label?u.a.cloneElement(n.label,{style:o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),t)}):u.a.createElement("div",{key:"__spacer."+s,style:t});i.push(r),s+=n.fields.length}))}var c=0;n.forEach((function(n){n.fields.forEach((function(n){i.push.apply(i,l(n.values))})),c+=n.fields.length}));var f=b(e.colws,c,"auto"),p=b(e.rowhs,d,"max-content");return{style:{display:"grid","grid-template-columns":f.join(" "),"grid-template-rows":p.join(" "),"grid-auto-flow":"column"},children:i}}var x=t(0),y={cell:Object(x.css)(O||(O=d(["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;"],["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;"]))),bborder:Object(x.css)(C||(C=d(["\n        border-bottom: 1px solid var(--border_bg);"],["\n        border-bottom: 1px solid var(--border_bg);"]))),tborder:Object(x.css)(E||(E=d(["\n        border-top: 1px solid var(--border_bg);"],["\n        border-top: 1px solid var(--border_bg);"]))),rborder:Object(x.css)(z||(z=d(["\n        border-right: 1px solid var(--border_bg);"],["\n        border-right: 1px solid var(--border_bg);"]))),lborder:Object(x.css)(P||(P=d(["\n        border-left: 1px solid var(--border_bg);"],["\n        border-left: 1px solid var(--border_bg);"]))),scrollbars:Object(x.css)(I||(I=d(["\n        ::-webkit-scrollbar {\n            height: revert;\n        }\n        ::-webkit-scrollbar-corner {\n            background-color: var(--panel_bg);\n        }"],["\n        ::-webkit-scrollbar {\n            height: revert;\n        }\n        ::-webkit-scrollbar-corner {\n            background-color: var(--panel_bg);\n        }"]))),aligns:Object(x.css)(K||(K=d(["\n        &[data-align='l'] {\n            text-align: left;\n        }\n        &[data-align='c'] {\n            text-align: center;\n        }\n        &[data-align='r'] {\n            text-align: right;\n        }"],["\n        &[data-align='l'] {\n            text-align: left;\n        }\n        &[data-align='c'] {\n            text-align: center;\n        }\n        &[data-align='r'] {\n            text-align: right;\n        }"])))},_={namecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(B||(B=d(["\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n            &[data-is_dimension] {\n                top: 0;\n                z-index: 3;\n                padding: 15px 16px 4px 16px;\n            }"],["\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n            &[data-is_dimension] {\n                top: 0;\n                z-index: 3;\n                padding: 15px 16px 4px 16px;\n            }"])))),valuecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(F||(F=d(["\n            text-align: right;\n            &[data-is_dimension] {\n                position: sticky;\n                background-color: var(--panel_bg);\n                top: 0;\n                z-index: 1;\n                padding: 15px 16px 4px 16px;\n                color: var(--hl);\n            }"],["\n            text-align: right;\n            &[data-is_dimension] {\n                position: sticky;\n                background-color: var(--panel_bg);\n                top: 0;\n                z-index: 1;\n                padding: 15px 16px 4px 16px;\n                color: var(--hl);\n            }"])))),grouplabel:Object(x.css)(T||(T=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n\n        padding: 19px 4px 0px 4px;\n        color: var(--hl);\n        display: inline-block;\n        width: auto;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n\n        padding: 19px 4px 0px 4px;\n        color: var(--hl);\n        display: inline-block;\n        width: auto;"])))},w={namecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(N||(N=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;\n\n        &[data-is_dimension] {\n            left: 0;\n            z-index: 3;\n        }"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;\n\n        &[data-is_dimension] {\n            left: 0;\n            z-index: 3;\n        }"])))),valuecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(V||(V=d(["\n        text-align: right;\n        &[data-is_dimension] {\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n        }"],["\n        text-align: right;\n        &[data-is_dimension] {\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n        }"])))),grouplabel:Object(x.css)(y.cell,y.lborder,y.rborder,Object(x.css)(M||(M=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        color: var(--hl);\n\n        padding: 8px 4px 0px 4px;\n\n        text-align: center;\n\n        white-space: normal;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        color: var(--hl);\n\n        padding: 8px 4px 0px 4px;\n\n        text-align: center;\n\n        white-space: normal;"]))))};var k,S,j,O,C,E,z,P,I,K,B,F,T,N,V,M,D,G=(k=v.config.theme,S={dim:k.colors.textSemiWeak,hl:k.colors.textBlue,panel_bg:k.colors.panelBg,border_bg:k.colors.border1,dash_bg:k.colors.dashboardBg},j=Object(x.css)(y.scrollbars,Object(x.css)(D||(D=d(["\n        overflow: auto;\n        position: relative;\n        --panel_bg: ",";\n        --dim: ",";\n        --hl: ",";\n        --border_bg: ",";\n        &[data-is_transparent] {\n            --panel_bg: ",";\n        }"],["\n        overflow: auto;\n        position: relative;\n        --panel_bg: ",";\n        --dim: ",";\n        --hl: ",";\n        --border_bg: ",";\n        &[data-is_transparent] {\n            --panel_bg: ",";\n        }"])),S.panel_bg,S.dim,S.hl,S.border_bg,S.dash_bg)),{vertical:o(o({},_),{grid:j}),horizontal:o(o({},w),{grid:j})});function A(n,e){return n&&n.length?function(n,e){var t=/\s*([r|c|l]?)\s*([0-9]*)\s*/,o=n.split(",").map((function(n){var e=n.match(t);return{a:e&&""!=e[1]?e[1]:void 0,w:e&&""!=e[2]?Number.parseInt(e[2]):0}})),r=o.length;r&&r<e&&(o.length=e,o.fill(o[r-1],r));return o}(n,e):[]}var H=u.a.createElement;function R(n,e,t,r){for(var i,a,l,d,s,u,p,g=t.df,v=t.formatter,b=t.order,m=Object(c.getFieldDisplayName)(n,g),h=r.is_dimension?"":void 0,x=null!==(i=n.display)&&void 0!==i?i:Object(c.getDisplayProcessor)({field:n}),y=e.show_common_unit&&n.type==c.FieldType.number?function(n){var e=n.config.mappings;n.config.mappings=void 0;var t=Object(c.getDisplayProcessor)({field:n})(1).suffix;return n.config.mappings=e,t&&t.length?t:void 0}(n):void 0,_=[H("div",{key:n.name,"data-align":null===(a=r.aligns)||void 0===a?void 0:a[0],"data-is_dimension":h,className:t.style.namecell},y?m+", "+y:m)],w=0;w<n.values.length;w++){var k=n.name+"."+w,S=n.values.get(b?b[w]:w);null==S&&(S=void 0);var j=x(S),O={raw:S,i:w,name:n.name,text:e.show_common_unit?j.text:""+(null!==(l=j.prefix)&&void 0!==l?l:"")+j.text+(null!==(d=j.suffix)&&void 0!==d?d:""),style:(u=null===(s=n.config.custom)||void 0===s?void 0:s.display_mode,p=j.color,p?"fg"==u?{color:p}:"bg"==u?{background:p,color:Object(f.getTextColorForBackground)(p)}:{}:{}),html:void 0};if(v)try{v(O,n,{})}catch(n){}var C={key:k,style:O.style,className:t.style.valuecell,"data-align":null==r?void 0:r.aligns[w+1],"data-is_dimension":h},E=(null==O?void 0:O.html)?H("div",o(o({},C),{dangerouslySetInnerHTML:{__html:O.html}})):H("div",o({},C),O.text);_.push(E)}return{values:_}}function L(n,e,t,o){var r=0;return n.map((function(n){var i="__group."+(null==n?void 0:n.name);return{label:n.name?H("div",{key:i,className:t.style.grouplabel},n.name):void 0,fields:n.fields.map((function(i){return R(i,e,t,function(n,t){return{is_dimension:t,aligns:e.is_horizontal?Array(o.length).fill(null==o?void 0:o[n]):o}}(r++,!!n.is_dim))}))}}))}function U(n,e){var t=e.sort;if(t.field&&t.field.length){var o=n.find((function(n){return n.name==t.field}));if(o){var r=o.values.toArray().map((function(n,e){return{v:0==n&&t.zeronull?null:n,i:e}}));return o.type==c.FieldType.number?r.sort((function(n,e){return function(n,e,t,o){return null==n&&null==e?0:null==n?t?-1:1:null==e?t?1:-1:o?e-n:n-e}(n.v,e.v,t.nullfirst,t.desc)})):r.sort((function(n,e){return function(n,e,t,o){if(null==n&&null==e)return 0;if(null==n)return t?-1:1;if(null==e)return t?1:-1;if(o){if(n>e)return-1;if(n<e)return 1}else{if(n<e)return-1;if(n>e)return 1}return 0}(n.v,e.v,t.nullfirst,t.desc)})),r.map((function(n){return n.i}))}}}t.d(e,"plugin",(function(){return X}));var W=[{kind:f.CodeEditorSuggestionItemKind.Field,label:"value"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.text"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.style"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.html"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"value.raw"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"value.name"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"value.i"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"field"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"field.name"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"lib"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"lib.moment"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"context"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"context.df"}];function q(n){var e=n.value,t=n.onChange;return u.a.createElement(f.CodeEditor,{value:e,onBlur:t,onSave:t,language:"javascript",showMiniMap:!1,showLineNumbers:!0,getSuggestions:function(){return W},height:400})}var J=function(n){return r(void 0,void 0,void 0,(function(){var e,t,o;return i(this,(function(r){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0],o=[],t.fields.filter((function(n){return n.labels})).forEach((function(n){return Object.entries(n.labels).forEach((function(n){var e=a(n,2),t=e[0],r=e[1];null==t||null==r||o.includes(t)||o.push(t)}))})),o.forEach((function(n){return e.push({label:n,value:n})}))),[2,Promise.resolve(e)]}))}))},Q=function(n){return r(void 0,void 0,void 0,(function(){var e,t;return i(this,(function(o){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0]).fields.forEach((function(n){var o=Object(c.getFieldDisplayName)(n,t);e.push({label:o!=n.name?o+" ("+n.name+")":n.name,value:n.name})})),[2,Promise.resolve(e)]}))}))},X=new c.PanelPlugin((function(n){var e,t,r=n.data,i=n.options,d=n.height,s=n.width,u=n.transparent;if(!(r.series&&r.series.length&&(null===(t=null===(e=r.series[0])||void 0===e?void 0:e.fields)||void 0===t?void 0:t.length)))return H("div",null,"No data");var c,f=r.series[0],p=f.fields,b=i.is_horizontal?G.horizontal:G.vertical,x=function(n){var e;return Math.max(n.length,null!==(e=(null==n?void 0:n[0].values.length)+1)&&void 0!==e?e:1)}(p),y=A(i.custom_columns,x);if(v.config.disableSanitizeHtml&&i.use_formatcode&&i.formatcode)try{var _=Function("value","field","context","lib",i.formatcode);c=function(n,e,t){return _(n,e,o({df:f},t),{moment:g.a})}}catch(n){}var w={formatter:c,df:f,style:b,order:U(p,i)},k=L(function(n,e,t){var o,r=[];if(e&&e.length){var i=n.find((function(n){return n.name==e}));i&&(r.push({fields:[i],is_dim:!0}),n=n.filter((function(n){return n!=i})))}if(t&&t.length){var d=new Map;d.set(void 0,[]),n.forEach((function(n){var e,o,r=null===(e=null==n?void 0:n.labels)||void 0===e?void 0:e[t];d.has(r)||d.set(r,[]),null===(o=d.get(r))||void 0===o||o.push(n)})),(null===(o=d.get(void 0))||void 0===o?void 0:o.length)||d.delete(void 0),r.push.apply(r,l(l(d).map((function(n){var e=a(n,2);return{name:e[0],fields:e[1]}}))))}else r.push({fields:n});return r}(p,i.dimension_field,i.group_by_label),i,w,y.map((function(n){return n.a}))),S=(i.is_horizontal?h:m)(k,{colws:y.length?y.map((function(n){return n.w})):void 0});return H("div",{style:{width:s,height:d,display:"flex","flex-direction":"column"}},H("div",o({className:b.grid,"data-is_transparent":u?"":void 0},S)))}));X.setPanelOptions((function(n){n.addSelect({path:"dimension_field",name:"Dimension field name",settings:{allowCustomValue:!0,options:[],getOptions:Q},defaultValue:""}).addBooleanSwitch({path:"is_horizontal",name:"Horizontal layout ",defaultValue:!1}).addBooleanSwitch({path:"show_common_unit",name:"Show common unit",defaultValue:!0}).addSelect({path:"group_by_label",name:"Group by label",settings:{allowCustomValue:!0,options:[],getOptions:J},defaultValue:""}).addTextInput({path:"custom_columns",name:"Custom column widths and text alignments",description:"Comma-separated format string: r100, c200, l300, etc"}).addSelect({path:"sort.field",name:"By field",settings:{allowCustomValue:!0,options:[],getOptions:Q},defaultValue:"",category:["Sort"]}).addBooleanSwitch({path:"sort.desc",name:"Descending",category:["Sort"]}).addBooleanSwitch({path:"sort.zeronull",name:"Treat zeros as nulls",category:["Sort"]}).addBooleanSwitch({path:"sort.nullfirst",name:"Nulls go first",category:["Sort"]}).addBooleanSwitch({path:"use_formatcode",name:"Use formatting code (DANGER!)",description:v.config.disableSanitizeHtml?"":"Feature is disabled. Set disable_sanitize_html = false in Grafana config to activate it.",category:["Custom formatting"],defaultValue:!1}).addCustomEditor({id:"formatcode",path:"formatcode",name:"Code",showIf:function(n){return n.use_formatcode&&v.config.disableSanitizeHtml},category:["Custom formatting"],editor:q,defaultValue:"\n/*\n    This code would be called for formatting each value.\n    The object 'value' is in scope for modification.\n\n    Set the text:\n      value.text = 'foo'\n    Set the style:\n      value.style = {'color': 'red', 'border': '1px solid'}\n    Render as html instead of text:\n      value.html = '<a href=\"http://www.grafana.com\">Go to base</a>'\n    Get raw (numeric) value:\n      let a = value.raw\n\n    Extra objects are in scope to help the formatting:\n      field: dataframe field of this value. The field.name is most useful here.\n      context.df: whole dataframe\n      lib.moment: moment.js library, handy for the datetimes.\n*/\n\nvalue.text = field.name + ':' + value.raw\nvalue.style = {'color': 'red'}"})})),X.useFieldConfig({useCustomConfig:function(n){n.addRadio({path:"display_mode",name:"Cell display mode",settings:{options:[{value:"auto",label:"Auto"},{value:"fg",label:"Color text"},{value:"bg",label:"Color background"}]},defaultValue:"auto"})}})}])}));
//# sourceMappingURL=module.js.map