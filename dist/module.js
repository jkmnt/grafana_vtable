define(["emotion","@grafana/ui","react","@grafana/data","@grafana/runtime","moment"],(function(e,n,t,o,r,l){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=6)}([function(n,t){n.exports=e},function(e,t){e.exports=n},function(e,n){e.exports=t},function(e,n){e.exports=o},function(e,n){e.exports=r},function(e,n){e.exports=l},function(e,n,t){"use strict";t.r(n);var o=function(){return(o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function r(e,n,t,o){return new(t||(t=Promise))((function(r,l){function i(e){try{u(o.next(e))}catch(e){l(e)}}function a(e){try{u(o.throw(e))}catch(e){l(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,a)}u((o=o.apply(e,n||[])).next())}))}function l(e,n){var t,o,r,l,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function a(l){return function(a){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=n.call(e,i)}catch(e){l=[6,e],o=0}finally{t=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}}function i(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,l=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(o=l.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=l.return)&&t.call(l)}finally{if(r)throw r.error}}return i}function a(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(i(arguments[n]));return e}function u(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e}var s=t(2),c=t.n(s),d=t(3),f=t(1),p=t(5),m=t.n(p),g=t(0),v=t(4);function h(e,n,t){var o=Array(n).fill(t);if(!e||!e.length)return o;for(var r=0;r<n;r++){var l=e[r];l&&l>0&&(o[r]=l+"px")}return o}function b(e){var n,t,r=e.groups,l=[],i=null!==(t=null===(n=r.find((function(e){return e.fields.length})))||void 0===n?void 0:n.fields[0].values.length)&&void 0!==t?t:0,u=0;r.forEach((function(e){var n;if(e.label){var t=o(o({},null===(n=e.label.props)||void 0===n?void 0:n.style),{"grid-column":"1 / span "+i,"justify-self":"start"});l.push(c.a.cloneElement(e.label,{style:t})),u+=1}e.fields.forEach((function(e){return l.push.apply(l,a(e.values))})),u+=e.fields.length}));var s=h(e.colws,i,"minmax(max-content, 1fr)"),d=h(e.rowhs,u,"max-content"),f={display:"grid","grid-template-columns":s.join(" "),"grid-template-rows":d.join(" ")};return c.a.createElement("div",{style:f,className:e.className},l)}function y(e){var n,t,r=e.groups,l=[],i=r.find((function(e){return e.label})),u=null!==(t=null===(n=r.find((function(e){return e.fields.length})))||void 0===n?void 0:n.fields[0].values.length)&&void 0!==t?t:0;if(i){u+=1;var s=1;r.forEach((function(e){var n,t={"grid-row":"1 / 2","grid-column":s+" / span "+e.fields.length},r=e.label?c.a.cloneElement(e.label,{style:o(o({},null===(n=e.label.props)||void 0===n?void 0:n.style),t)}):c.a.createElement("div",{style:t});l.push(r),s+=e.fields.length}))}var d=0;r.forEach((function(e){e.fields.forEach((function(e){l.push.apply(l,a(e.values))})),d+=e.fields.length}));var f=h(e.colws,d,"auto"),p=h(e.rowhs,u,"max-content"),m={display:"grid","grid-template-columns":f.join(" "),"grid-template-rows":p.join(" "),"grid-auto-flow":"column"};return c.a.createElement("div",{style:m,className:e.className},l)}Object(g.css)(w||(w=u(["text-align: left;"],["text-align: left;"]))),Object(g.css)(j||(j=u(["text-align: center;"],["text-align: center;"]))),Object(g.css)(O||(O=u(["text-align: right;"],["text-align: right;"])));var x,w,j,O,S,_,E,k,C,z,P,N,I,T,B,F,K,V,M=void 0;function D(e){var n=Object(g.css)(S||(S=u(["\n        padding: 8px;\n        white-space: nowrap;\n    "],["\n        padding: 8px;\n        white-space: nowrap;\n    "]))),t=Object(g.css)(_||(_=u(["\n        border-bottom: 1px solid ",";\n    "],["\n        border-bottom: 1px solid ",";\n    "])),e.border_bg),o=(Object(g.css)(E||(E=u(["\n        border-right: 1px solid ",";\n    "],["\n        border-right: 1px solid ",";\n    "])),e.border_bg),Object(g.css)(k||(k=u(["\n        position: sticky;\n        background-color: ",";\n    "],["\n        position: sticky;\n        background-color: ",";\n    "])),e.sticky_bg)),r={field:{name:Object(g.css)(n,o,t,Object(g.css)(C||(C=u(["\n                left: 0;\n                z-index: 2;\n                color: ",";\n            "],["\n                left: 0;\n                z-index: 2;\n                color: ",";\n            "])),e.dim)),value:Object(g.css)(n,t,Object(g.css)(z||(z=u(["\n                text-align: right;\n            "],["\n                text-align: right;\n            "]))))},dimfield:{name:Object(g.css)(n,o,Object(g.css)(P||(P=u(["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                color: ",";\n            "],["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                color: ",";\n            "])),e.dim)),value:Object(g.css)(n,o,Object(g.css)(N||(N=u(["\n                top: 0;\n                z-index: 1;\n\n                color: ",";\n\n                text-align: right;\n            "],["\n                top: 0;\n                z-index: 1;\n\n                color: ",";\n\n                text-align: right;\n            "])),e.hl))},grouplabel:Object(g.css)(o,Object(g.css)(I||(I=u(["\n            left: 0;\n            z-index: 2;\n\n            padding: 16px 8px 0 4px;\n            color: ",";\n        "],["\n            left: 0;\n            z-index: 2;\n\n            padding: 16px 8px 0 4px;\n            color: ",";\n        "])),e.hl))};return{h:{field:{name:Object(g.css)(n,o,Object(g.css)(T||(T=u(["\n                top: 0;\n                z-index: 1;\n\n                color: ",";\n\n                text-align: right;\n                white-space: normal;\n            "],["\n                top: 0;\n                z-index: 1;\n\n                color: ",";\n\n                text-align: right;\n                white-space: normal;\n            "])),e.hl)),value:Object(g.css)(n,t,Object(g.css)(B||(B=u(["\n                text-align: right;\n            "],["\n                text-align: right;\n            "]))))},dimfield:{name:Object(g.css)(n,o,Object(g.css)(F||(F=u(["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                color: ",";\n\n                text-align: right;\n                white-space: normal;\n            "],["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                color: ",";\n\n                text-align: right;\n                white-space: normal;\n            "])),e.hl)),value:Object(g.css)(n,o,t,Object(g.css)(K||(K=u(["\n                left: 0;\n                z-index: 2;\n\n                color: ",";\n                text-align: right;\n            "],["\n                left: 0;\n                z-index: 2;\n\n                color: ",";\n                text-align: right;\n            "])),e.dim))},grouplabel:Object(g.css)(n,o,Object(g.css)(V||(V=u(["\n            top: 0;\n            color: ",";\n\n            text-align: center;\n\n            white-space: normal;\n        "],["\n            top: 0;\n            color: ",";\n\n            text-align: center;\n\n            white-space: normal;\n        "])),e.hl))},v:r}}var G,H=c.a.createElement;function A(e,n,t,o){var r=0;return e.map((function(e){return{label:e.name?H("div",{key:"__group."+e.name,className:t.style.grouplabel},e.name):void 0,fields:e.fields.map((function(l){return function(e,n,t,o){var r,l,i,a=t.df,u=t.formatter,s=t.order,c=Object(d.getFieldDisplayName)(e,a);e.display||(e.display=Object(d.getDisplayProcessor)({field:e}));var p=void 0;if(n.show_common_unit&&e.type==d.FieldType.number){var m=e.config.mappings;e.config.mappings=void 0,p=Object(d.getDisplayProcessor)({field:e})(1).suffix,e.config.mappings=m}for(var g,v,h=[H("div",{key:e.name,className:o.name},p?c+", "+p:c)],b=0;b<e.values.length;b++){var y=e.name+"."+b,x=e.values.get(s?s[b]:b);null==x&&(x=void 0);var w=e.display(x),j={raw:x,i:b,text:n.show_common_unit?w.text:""+(null!==(r=w.prefix)&&void 0!==r?r:"")+w.text+(null!==(l=w.suffix)&&void 0!==l?l:""),style:(g=null===(i=e.config.custom)||void 0===i?void 0:i.display_mode,v=w.color,v?"fg"==g?{color:v}:"bg"==g?{background:v,color:Object(f.getTextColorForBackground)(v)}:{}:{}),html:void 0};if(u)try{u(j,e,{})}catch(e){}var O=void 0;O=(null==j?void 0:j.html)?H("div",{key:y,style:j.style,className:o.value(b),dangerouslySetInnerHTML:{__html:j.html}}):H("div",{key:y,style:j.style,className:o.value(b)},j.text),h.push(O)}return{values:h}}(l,n,t,function(e,r){var l=r?t.style.dimfield:t.style.field;return n.is_horizontal?{name:Object(g.css)(l.name,o[e]),value:function(n){return Object(g.css)(l.value,o[e])}}:{name:Object(g.css)(l.name,o[0]),value:function(e){return Object(g.css)(l.value,o[e+1])}}}(r++,!!e.is_dim))}))}}))}function R(e,n){var t=n.sort;if(t.field&&t.field.length){var o=e.find((function(e){return e.name==t.field}));if(o){var r=o.values.toArray().map((function(e,n){return{v:0==e&&t.zeronull?null:e,i:n}}));return o.type==d.FieldType.number?r.sort((function(e,n){return function(e,n,t,o){return null==e&&null==n?0:null==e?t?-1:1:null==n?t?1:-1:o?n-e:e-n}(e.v,n.v,t.nullfirst,t.desc)})):r.sort((function(e,n){return function(e,n,t,o){if(null==e&&null==n)return 0;if(null==e)return t?-1:1;if(null==n)return t?1:-1;if(o){if(e>n)return-1;if(e<n)return 1}else{if(e<n)return-1;if(e>n)return 1}return 0}(e.v,n.v,t.nullfirst,t.desc)})),r.map((function(e){return e.i}))}}}function L(e,n){return e&&e.length?(t=n,o=/\s*([r|c|l]?)\s*([0-9]*)\s*/,r=e.split(",").map((function(e){var n=e.match(o);return{a:n&&""!=n[1]?n[1]:void 0,w:n&&""!=n[2]?Number.parseInt(n[2]):0}})),(l=r.length)&&l<t&&(r.length=t,r.fill(r[l-1],l)),r):[];var t,o,r,l}t.d(n,"plugin",(function(){return Q}));var U=[{kind:f.CodeEditorSuggestionItemKind.Field,label:"value"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.raw"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.text"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.style"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.html"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"field"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"field.name"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"lib"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"lib.moment"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"context"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"context.df"}];function W(e){var n=e.value,t=e.onChange;return c.a.createElement(f.CodeEditor,{value:n,onBlur:t,onSave:t,language:"javascript",showMiniMap:!1,showLineNumbers:!0,getSuggestions:function(){return U},height:400})}var q=function(e){return r(void 0,void 0,void 0,(function(){var n,t,o;return l(this,(function(r){return n=[{value:"",label:"─"}],e&&e.data&&e.data.length&&(t=e.data[0],o=[],t.fields.filter((function(e){return e.labels})).forEach((function(e){return Object.entries(e.labels).forEach((function(e){var n=i(e,2),t=n[0],r=n[1];null==t||null==r||o.includes(t)||o.push(t)}))})),o.forEach((function(e){return n.push({label:e,value:e})}))),[2,Promise.resolve(n)]}))}))},J=function(e){return r(void 0,void 0,void 0,(function(){var n,t;return l(this,(function(o){return n=[{value:"",label:"─"}],e&&e.data&&e.data.length&&(t=e.data[0]).fields.forEach((function(e){var o=Object(d.getFieldDisplayName)(e,t);n.push({label:o!=e.name?o+" ("+e.name+")":e.name,value:e.name})})),[2,Promise.resolve(n)]}))}))},Q=new d.PanelPlugin((function(e){var n,t,r=e.data,l=e.options,s=e.height,c=e.width,d=e.transparent;if(!(r.series&&r.series.length&&(null===(t=null===(n=r.series[0])||void 0===n?void 0:n.fields)||void 0===t?void 0:t.length)))return H("div",null,"No data");var p,h=r.series[0],w=h.fields,j=function(e,n){var t=Object(f.useTheme)();if(!M||x!=t){var r={dim:t.colors.textWeak,hl:t.colors.textBlue,sticky_bg:t.colors.panelBg,border_bg:t.colors.border1};M={normal:D(r),transparent:D(o(o({},r),{sticky_bg:t.colors.dashboardBg}))},x=t}return(n?M.transparent:M.normal)[e?"h":"v"]}(!!l.is_horizontal,d),O=function(e){var n;return Math.max(e.length,null!==(n=(null==e?void 0:e[0].values.length)+1)&&void 0!==n?n:1)}(w),S=L(l.custom_columns,O);if(v.config.disableSanitizeHtml&&l.use_formatcode&&l.formatcode)try{var _=Function("value","field","context","lib",l.formatcode);p=function(e,n,t){return _(e,n,o({df:h},t),{moment:m.a})}}catch(e){}var E={formatter:p,df:h,style:j,order:R(w,l)},k=A(function(e,n){var t,o=n.dimension_field,r=n.group_by_label,l=[];if(o&&o.length){var u=e.find((function(e){return e.name==o}));u&&(l.push({fields:[u],is_dim:!0}),e=e.filter((function(e){return e!=u})))}if(r&&r.length){var s=new Map;s.set(void 0,[]),e.forEach((function(e){var n,t,o=null===(n=null==e?void 0:e.labels)||void 0===n?void 0:n[r];s.has(o)||s.set(o,[]),null===(t=s.get(o))||void 0===t||t.push(e)})),(null===(t=s.get(void 0))||void 0===t?void 0:t.length)||s.delete(void 0),l.push.apply(l,a(a(s).map((function(e){var n=i(e,2);return{name:n[0],fields:n[1]}}))))}else l.push({fields:e});return l}(w,l),l,E,S.map((function(e){return e.a})));return H(l.is_horizontal?y:b,{className:Object(g.css)(G||(G=u(["\n                width: ","px;\n                height: ","px;\n                overflow: auto;\n              "],["\n                width: ","px;\n                height: ","px;\n                overflow: auto;\n              "])),c,s),groups:k,colws:S.length?S.map((function(e){return e.w})):void 0})}));Q.setPanelOptions((function(e){e.addSelect({path:"dimension_field",name:"Dimension field name",settings:{allowCustomValue:!0,options:[],getOptions:J},defaultValue:""}).addBooleanSwitch({path:"is_horizontal",name:"Horizontal layout ",defaultValue:!1}).addBooleanSwitch({path:"show_common_unit",name:"Show common unit",defaultValue:!0}).addSelect({path:"group_by_label",name:"Group by label",settings:{allowCustomValue:!0,options:[],getOptions:q},defaultValue:""}).addTextInput({path:"custom_columns",name:"Custom column widths and text alignments",description:"Comma-separated format string: r100, c200, l300, etc"}).addSelect({path:"sort.field",name:"By field",settings:{allowCustomValue:!0,options:[],getOptions:J},defaultValue:"",category:["Sort"]}).addBooleanSwitch({path:"sort.desc",name:"Descending",category:["Sort"]}).addBooleanSwitch({path:"sort.zeronull",name:"Treat zeros as nulls",category:["Sort"]}).addBooleanSwitch({path:"sort.nullfirst",name:"Nulls go first",category:["Sort"]}).addBooleanSwitch({path:"use_formatcode",name:"Use formatting code (DANGER!)",description:v.config.disableSanitizeHtml?"":"Feature is disabled. Set disable_sanitize_html = false in Grafana config to activate it.",category:["Custom formatting"],defaultValue:!1}).addCustomEditor({id:"formatcode",path:"formatcode",name:"Code",showIf:function(e){return e.use_formatcode&&v.config.disableSanitizeHtml},category:["Custom formatting"],editor:W,defaultValue:"\n/*\n    This code would be called for formatting each value.\n    The object 'value' is in scope for modification.\n\n    Set the text:\n      value.text = 'foo'\n    Set the style:\n      value.style = {'color': 'red', 'border': '1px solid'}\n    Render as html instead of text:\n      value.html = '<a href=\"http://www.grafana.com\">Go to base</a>'\n    Get raw (numeric) value:\n      let a = value.raw\n\n    Extra objects are in scope to help the formatting:\n      field: dataframe field of this value. The field.name is most useful here.\n      context.df: whole dataframe\n      lib.moment: moment.js library, handy for the datetimes.\n*/\n\nvalue.text = field.name + ':' + value.raw\nvalue.style = {'color': 'red'}"})})),Q.useFieldConfig({useCustomConfig:function(e){e.addRadio({path:"display_mode",name:"Cell display mode",settings:{options:[{value:"auto",label:"Auto"},{value:"fg",label:"Color text"},{value:"bg",label:"Color background"}]},defaultValue:"auto"})}})}])}));
//# sourceMappingURL=module.js.map