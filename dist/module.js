define(["emotion","@grafana/ui","@grafana/data","react","@grafana/runtime","moment"],(function(n,e,t,o,r,l){return function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/",t(t.s=6)}([function(e,t){e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=t},function(n,e){n.exports=o},function(n,e){n.exports=r},function(n,e){n.exports=l},function(n,e,t){"use strict";t.r(e);var o=function(){return(o=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};function r(n,e,t,o){return new(t||(t=Promise))((function(r,l){function i(n){try{u(o.next(n))}catch(n){l(n)}}function a(n){try{u(o.throw(n))}catch(n){l(n)}}function u(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(i,a)}u((o=o.apply(n,e||[])).next())}))}function l(n,e){var t,o,r,l,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function a(l){return function(a){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(n,i)}catch(n){l=[6,n],o=0}finally{t=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}}function i(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,r,l=t.call(n),i=[];try{for(;(void 0===e||e-- >0)&&!(o=l.next()).done;)i.push(o.value)}catch(n){r={error:n}}finally{try{o&&!o.done&&(t=l.return)&&t.call(l)}finally{if(r)throw r.error}}return i}function a(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(i(arguments[e]));return n}function u(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var s=t(3),c=t.n(s),d=t(2),f=t(1),p=t(5),g=t.n(p),m=t(0),v=t(4);function h(n,e,t){var o=Array(e).fill(t);if(!n||!n.length)return o;for(var r=0;r<e;r++){var l=n[r];l&&l>0&&(o[r]=l+"px")}return o}function b(n,e){var t,r;void 0===e&&(e={});var l=[],i=null!==(r=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==r?r:0,u=0;n.forEach((function(n){var e;if(n.label){var t=o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),{"grid-column":"1 / span "+i,"justify-self":"start"});l.push(c.a.cloneElement(n.label,{style:t})),u+=1}n.fields.forEach((function(n){return l.push.apply(l,a(n.values))})),u+=n.fields.length}));var s=h(e.colws,i,"minmax(max-content, 1fr)"),d=h(e.rowhs,u,"max-content");return{style:{display:"grid","grid-template-columns":s.join(" "),"grid-template-rows":d.join(" ")},children:l}}function x(n,e){var t,r;void 0===e&&(e={});var l=[],i=n.find((function(n){return n.label})),u=null!==(r=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==r?r:0;if(i){u+=1;var s=1;n.forEach((function(n){var e,t={"grid-row":"1 / 2","grid-column":s+" / span "+n.fields.length},r=n.label?c.a.cloneElement(n.label,{style:o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),t)}):c.a.createElement("div",{key:"__spacer."+s,style:t});l.push(r),s+=n.fields.length}))}var d=0;n.forEach((function(n){n.fields.forEach((function(n){l.push.apply(l,a(n.values))})),d+=n.fields.length}));var f=h(e.colws,d,"auto"),p=h(e.rowhs,u,"max-content");return{style:{display:"grid","grid-template-columns":f.join(" "),"grid-template-rows":p.join(" "),"grid-auto-flow":"column"},children:l}}var y={l:Object(m.css)(_||(_=u(["text-align: left;"],["text-align: left;"]))),c:Object(m.css)(S||(S=u(["text-align: center;"],["text-align: center;"]))),r:Object(m.css)(k||(k=u(["text-align: right;"],["text-align: right;"])))};function w(n){var e=Object(m.css)(E||(E=u(["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;\n    "],["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;\n    "]))),t=Object(m.css)(C||(C=u(["\n        border-bottom: 1px solid ",";\n    "],["\n        border-bottom: 1px solid ",";\n    "])),n.border_bg),o=(Object(m.css)(z||(z=u(["\n        border-top: 1px solid ",";\n    "],["\n        border-top: 1px solid ",";\n    "])),n.border_bg),Object(m.css)(P||(P=u(["\n        border-right: 1px solid ",";\n    "],["\n        border-right: 1px solid ",";\n    "])),n.border_bg)),r=Object(m.css)(I||(I=u(["\n        border-left: 1px solid ",";\n    "],["\n        border-left: 1px solid ",";\n    "])),n.border_bg),l=Object(m.css)(N||(N=u(["\n        position: sticky;\n        background-color: ",";\n    "],["\n        position: sticky;\n        background-color: ",";\n    "])),n.sticky_bg),i=Object(m.css)(B||(B=u(["\n      ::-webkit-scrollbar {\n        height: revert;\n      }\n      ::-webkit-scrollbar-corner {\n        background-color: ",";\n      }"],["\n      ::-webkit-scrollbar {\n        height: revert;\n      }\n      ::-webkit-scrollbar-corner {\n        background-color: ",";\n      }"])),n.sticky_bg),a={field:{name:Object(m.css)(e,l,t,Object(m.css)(F||(F=u(["\n                left: 0;\n                z-index: 2;\n                color: ",";\n            "],["\n                left: 0;\n                z-index: 2;\n                color: ",";\n            "])),n.dim)),value:Object(m.css)(e,t,Object(m.css)(T||(T=u(["\n                text-align: right;\n            "],["\n                text-align: right;\n            "]))))},dimfield:{name:Object(m.css)(e,l,t,Object(m.css)(K||(K=u(["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                padding: 15px 16px 4px 16px;\n\n                color: ",";\n            "],["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                padding: 15px 16px 4px 16px;\n\n                color: ",";\n            "])),n.dim)),value:Object(m.css)(e,l,t,Object(m.css)(V||(V=u(["\n                top: 0;\n                z-index: 1;\n\n                padding: 15px 16px 4px 16px;\n\n                color: ",";\n\n                text-align: right;\n            "],["\n                top: 0;\n                z-index: 1;\n\n                padding: 15px 16px 4px 16px;\n\n                color: ",";\n\n                text-align: right;\n            "])),n.hl))},grouplabel:Object(m.css)(l,Object(m.css)(M||(M=u(["\n            left: 0;\n            z-index: 2;\n\n            padding: 19px 4px 0px 4px;\n            color: ",";\n        "],["\n            left: 0;\n            z-index: 2;\n\n            padding: 19px 4px 0px 4px;\n            color: ",";\n        "])),n.hl)),scrollbars:i};return{h:{field:{name:Object(m.css)(e,l,t,Object(m.css)(D||(D=u(["\n                top: 0;\n                z-index: 1;\n\n                color: ",";\n\n                padding: 7px 16px 4px 16px;\n\n                text-align: right;\n                white-space: normal;\n            "],["\n                top: 0;\n                z-index: 1;\n\n                color: ",";\n\n                padding: 7px 16px 4px 16px;\n\n                text-align: right;\n                white-space: normal;\n            "])),n.hl)),value:Object(m.css)(e,t,Object(m.css)(G||(G=u(["\n                text-align: right;\n            "],["\n                text-align: right;\n            "]))))},dimfield:{name:Object(m.css)(e,l,t,Object(m.css)(H||(H=u(["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                padding: 7px 16px 4px 16px;\n\n                color: ",";\n\n                text-align: right;\n                white-space: normal;\n            "],["\n                left: 0;\n                top: 0;\n                z-index: 3;\n\n                padding: 7px 16px 4px 16px;\n\n                color: ",";\n\n                text-align: right;\n                white-space: normal;\n            "])),n.hl)),value:Object(m.css)(e,l,t,Object(m.css)(A||(A=u(["\n                left: 0;\n                z-index: 2;\n\n                color: ",";\n                text-align: right;\n            "],["\n                left: 0;\n                z-index: 2;\n\n                color: ",";\n                text-align: right;\n            "])),n.dim))},grouplabel:Object(m.css)(e,l,r,o,Object(m.css)(R||(R=u(["\n            top: 0;\n            color: ",";\n\n            padding: 8px 4px 0px 4px;\n\n            text-align: center;\n\n            white-space: normal;\n        "],["\n            top: 0;\n            color: ",";\n\n            padding: 8px 4px 0px 4px;\n\n            text-align: center;\n\n            white-space: normal;\n        "])),n.hl)),scrollbars:i},v:a}}var j,O,_,S,k,E,C,z,P,I,N,B,F,T,K,V,M,D,G,H,A,R,L=(j=v.config.theme,{normal:w(O={dim:j.colors.textSemiWeak,hl:j.colors.textBlue,sticky_bg:j.colors.panelBg,border_bg:j.colors.border1}),transparent:w(o(o({},O),{sticky_bg:j.colors.dashboardBg}))});function U(n,e){return n&&n.length?function(n,e){var t=/\s*([r|c|l]?)\s*([0-9]*)\s*/,o=n.split(",").map((function(n){var e=n.match(t);return{a:e&&""!=e[1]?e[1]:void 0,w:e&&""!=e[2]?Number.parseInt(e[2]):0}})),r=o.length;r&&r<e&&(o.length=e,o.fill(o[r-1],r));return o}(n,e):[]}var W,q,J=c.a.createElement;function Q(n,e,t,o){for(var r,l,i,a,u,s,c=t.df,p=t.formatter,g=t.order,m=Object(d.getFieldDisplayName)(n,c),v=null!==(r=n.display)&&void 0!==r?r:Object(d.getDisplayProcessor)({field:n}),h=e.show_common_unit&&n.type==d.FieldType.number?function(n){var e=n.config.mappings;n.config.mappings=void 0;var t=Object(d.getDisplayProcessor)({field:n})(1).suffix;return n.config.mappings=e,t&&t.length?t:void 0}(n):void 0,b=[J("div",{key:n.name,className:o.name},h?m+", "+h:m)],x=0;x<n.values.length;x++){var y=n.name+"."+x,w=n.values.get(g?g[x]:x);null==w&&(w=void 0);var j=v(w),O={raw:w,i:x,name:n.name,text:e.show_common_unit?j.text:""+(null!==(l=j.prefix)&&void 0!==l?l:"")+j.text+(null!==(i=j.suffix)&&void 0!==i?i:""),style:(u=null===(a=n.config.custom)||void 0===a?void 0:a.display_mode,s=j.color,s?"fg"==u?{color:s}:"bg"==u?{background:s,color:Object(f.getTextColorForBackground)(s)}:{}:{}),html:void 0};if(p)try{p(O,n,{})}catch(n){}var _=void 0;_=(null==O?void 0:O.html)?J("div",{key:y,style:O.style,className:o.value(x),dangerouslySetInnerHTML:{__html:O.html}}):J("div",{key:y,style:O.style,className:o.value(x)},O.text),b.push(_)}return{values:b}}function X(n,e,t,o){var r=0;return n.map((function(n){var l="__group."+(null==n?void 0:n.name);return{label:n.name?J("div",{key:l,className:t.style.grouplabel},n.name):void 0,fields:n.fields.map((function(l){return Q(l,e,t,function(n,r){var l=r?t.style.dimfield:t.style.field;return e.is_horizontal?{name:Object(m.css)(l.name,o[n]),value:function(e){return Object(m.css)(l.value,o[n])}}:{name:Object(m.css)(l.name,o[0]),value:function(n){return Object(m.css)(l.value,o[n+1])}}}(r++,!!n.is_dim))}))}}))}function Y(n,e){var t=e.sort;if(t.field&&t.field.length){var o=n.find((function(n){return n.name==t.field}));if(o){var r=o.values.toArray().map((function(n,e){return{v:0==n&&t.zeronull?null:n,i:e}}));return o.type==d.FieldType.number?r.sort((function(n,e){return function(n,e,t,o){return null==n&&null==e?0:null==n?t?-1:1:null==e?t?1:-1:o?e-n:n-e}(n.v,e.v,t.nullfirst,t.desc)})):r.sort((function(n,e){return function(n,e,t,o){if(null==n&&null==e)return 0;if(null==n)return t?-1:1;if(null==e)return t?1:-1;if(o){if(n>e)return-1;if(n<e)return 1}else{if(n<e)return-1;if(n>e)return 1}return 0}(n.v,e.v,t.nullfirst,t.desc)})),r.map((function(n){return n.i}))}}}t.d(e,"plugin",(function(){return tn}));var Z=[{kind:f.CodeEditorSuggestionItemKind.Field,label:"value"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.raw"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.text"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.style"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.html"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"field"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"field.name"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"lib"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"lib.moment"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"context"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"context.df"}];function $(n){var e=n.value,t=n.onChange;return c.a.createElement(f.CodeEditor,{value:e,onBlur:t,onSave:t,language:"javascript",showMiniMap:!1,showLineNumbers:!0,getSuggestions:function(){return Z},height:400})}var nn=function(n){return r(void 0,void 0,void 0,(function(){var e,t,o;return l(this,(function(r){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0],o=[],t.fields.filter((function(n){return n.labels})).forEach((function(n){return Object.entries(n.labels).forEach((function(n){var e=i(n,2),t=e[0],r=e[1];null==t||null==r||o.includes(t)||o.push(t)}))})),o.forEach((function(n){return e.push({label:n,value:n})}))),[2,Promise.resolve(e)]}))}))},en=function(n){return r(void 0,void 0,void 0,(function(){var e,t;return l(this,(function(o){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0]).fields.forEach((function(n){var o=Object(d.getFieldDisplayName)(n,t);e.push({label:o!=n.name?o+" ("+n.name+")":n.name,value:n.name})})),[2,Promise.resolve(e)]}))}))},tn=new d.PanelPlugin((function(n){var e,t,r=n.data,l=n.options,s=n.height,c=n.width,d=n.transparent;if(!(r.series&&r.series.length&&(null===(t=null===(e=r.series[0])||void 0===e?void 0:e.fields)||void 0===t?void 0:t.length)))return J("div",null,"No data");var f,p=r.series[0],h=p.fields,w=function(n,e){return(e?L.transparent:L.normal)[n?"h":"v"]}(!!l.is_horizontal,d),j=function(n){var e;return Math.max(n.length,null!==(e=(null==n?void 0:n[0].values.length)+1)&&void 0!==e?e:1)}(h),O=U(l.custom_columns,j);if(v.config.disableSanitizeHtml&&l.use_formatcode&&l.formatcode)try{var _=Function("value","field","context","lib",l.formatcode);f=function(n,e,t){return _(n,e,o({df:p},t),{moment:g.a})}}catch(n){}var S={formatter:f,df:p,style:w,order:Y(h,l)},k=X(function(n,e,t){var o,r=[];if(e&&e.length){var l=n.find((function(n){return n.name==e}));l&&(r.push({fields:[l],is_dim:!0}),n=n.filter((function(n){return n!=l})))}if(t&&t.length){var u=new Map;u.set(void 0,[]),n.forEach((function(n){var e,o,r=null===(e=null==n?void 0:n.labels)||void 0===e?void 0:e[t];u.has(r)||u.set(r,[]),null===(o=u.get(r))||void 0===o||o.push(n)})),(null===(o=u.get(void 0))||void 0===o?void 0:o.length)||u.delete(void 0),r.push.apply(r,a(a(u).map((function(n){var e=i(n,2);return{name:e[0],fields:e[1]}}))))}else r.push({fields:n});return r}(h,l.dimension_field,l.group_by_label),l,S,O.map((function(n){return n.a?y[n.a]:void 0}))),E=(l.is_horizontal?x:b)(k,{colws:O.length?O.map((function(n){return n.w})):void 0});return J("div",{style:{width:c,height:s},className:Object(m.css)(W||(W=u(["\n        display: flex;\n        flex-direction: column;\n      "],["\n        display: flex;\n        flex-direction: column;\n      "])))},J("div",o({className:Object(m.css)(Object(m.css)(q||(q=u(["\n          overflow: auto;\n        "],["\n          overflow: auto;\n        "]))),w.scrollbars)},E)))}));tn.setPanelOptions((function(n){n.addSelect({path:"dimension_field",name:"Dimension field name",settings:{allowCustomValue:!0,options:[],getOptions:en},defaultValue:""}).addBooleanSwitch({path:"is_horizontal",name:"Horizontal layout ",defaultValue:!1}).addBooleanSwitch({path:"show_common_unit",name:"Show common unit",defaultValue:!0}).addSelect({path:"group_by_label",name:"Group by label",settings:{allowCustomValue:!0,options:[],getOptions:nn},defaultValue:""}).addTextInput({path:"custom_columns",name:"Custom column widths and text alignments",description:"Comma-separated format string: r100, c200, l300, etc"}).addSelect({path:"sort.field",name:"By field",settings:{allowCustomValue:!0,options:[],getOptions:en},defaultValue:"",category:["Sort"]}).addBooleanSwitch({path:"sort.desc",name:"Descending",category:["Sort"]}).addBooleanSwitch({path:"sort.zeronull",name:"Treat zeros as nulls",category:["Sort"]}).addBooleanSwitch({path:"sort.nullfirst",name:"Nulls go first",category:["Sort"]}).addBooleanSwitch({path:"use_formatcode",name:"Use formatting code (DANGER!)",description:v.config.disableSanitizeHtml?"":"Feature is disabled. Set disable_sanitize_html = false in Grafana config to activate it.",category:["Custom formatting"],defaultValue:!1}).addCustomEditor({id:"formatcode",path:"formatcode",name:"Code",showIf:function(n){return n.use_formatcode&&v.config.disableSanitizeHtml},category:["Custom formatting"],editor:$,defaultValue:"\n/*\n    This code would be called for formatting each value.\n    The object 'value' is in scope for modification.\n\n    Set the text:\n      value.text = 'foo'\n    Set the style:\n      value.style = {'color': 'red', 'border': '1px solid'}\n    Render as html instead of text:\n      value.html = '<a href=\"http://www.grafana.com\">Go to base</a>'\n    Get raw (numeric) value:\n      let a = value.raw\n\n    Extra objects are in scope to help the formatting:\n      field: dataframe field of this value. The field.name is most useful here.\n      context.df: whole dataframe\n      lib.moment: moment.js library, handy for the datetimes.\n*/\n\nvalue.text = field.name + ':' + value.raw\nvalue.style = {'color': 'red'}"})})),tn.useFieldConfig({useCustomConfig:function(n){n.addRadio({path:"display_mode",name:"Cell display mode",settings:{options:[{value:"auto",label:"Auto"},{value:"fg",label:"Color text"},{value:"bg",label:"Color background"}]},defaultValue:"auto"})}})}])}));
//# sourceMappingURL=module.js.map