define(["emotion","@grafana/ui","react","@grafana/data","@grafana/runtime","moment"],(function(n,e,t,o,r,a){return function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/",t(t.s=6)}([function(e,t){e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=t},function(n,e){n.exports=o},function(n,e){n.exports=r},function(n,e){n.exports=a},function(n,e,t){"use strict";t.r(e);var o=function(){return(o=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};function r(n,e,t,o){return new(t||(t=Promise))((function(r,a){function l(n){try{d(o.next(n))}catch(n){a(n)}}function i(n){try{d(o.throw(n))}catch(n){a(n)}}function d(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,i)}d((o=o.apply(n,e||[])).next())}))}function a(n,e){var t,o,r,a,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,o=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){l=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){l.label=a[1];break}if(6===a[0]&&l.label<r[1]){l.label=r[1],r=a;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(a);break}r[2]&&l.ops.pop(),l.trys.pop();continue}a=e.call(n,l)}catch(n){a=[6,n],o=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}function l(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,r,a=t.call(n),l=[];try{for(;(void 0===e||e-- >0)&&!(o=a.next()).done;)l.push(o.value)}catch(n){r={error:n}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(r)throw r.error}}return l}function i(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(l(arguments[e]));return n}function d(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var s=t(2),u=t.n(s),c=t(3),f=t(1),p=t(5),g=t.n(p),v=t(4);function b(n,e,t){var o=Array(e).fill(t);if(!n||!n.length)return o;for(var r=0;r<e;r++){var a=n[r];a&&a>0&&(o[r]=a+"px")}return o}function m(n,e){var t,o;void 0===e&&(e={});var r=[],a=null!==(o=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==o?o:0,l=0;n.forEach((function(n){if(n.label){var t=u.a.createElement("div",{key:n.label.key,style:{"grid-column":"1 / -1"}},n.label);r.push(t),l+=1}n.fields.forEach((function(n){return r.push.apply(r,i(n.values.map((function(n,t){var o,r=null===(o=null==e?void 0:e.colattrs)||void 0===o?void 0:o[t];return r?u.a.cloneElement(n,r):n}))))})),l+=n.fields.length}));var d=b(e.colws,a,"minmax(max-content, 1fr)"),s=b(e.rowhs,l,"max-content");return{style:{display:"grid","grid-template-columns":d.join(" "),"grid-template-rows":s.join(" ")},children:r}}function h(n,e){var t,r;void 0===e&&(e={});var a=[],l=n.find((function(n){return n.label})),d=null!==(r=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==r?r:0;if(l){d+=1;var s=1;n.forEach((function(n){var e,t={"grid-row":"1 / 2","grid-column":s+" / span "+n.fields.length},r=n.label?u.a.cloneElement(n.label,{style:o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),t)}):u.a.createElement("div",{key:"__spacer."+s,style:t});a.push(r),s+=n.fields.length}))}var c=0,f=0;n.forEach((function(n){n.fields.forEach((function(n){var t,o=null===(t=null==e?void 0:e.colattrs)||void 0===t?void 0:t[f++];o?a.push.apply(a,i(n.values.map((function(n){return u.a.cloneElement(n,o)})))):a.push.apply(a,i(n.values))})),c+=n.fields.length}));var p=b(e.colws,c,"auto"),g=b(e.rowhs,d,"max-content");return{style:{display:"grid","grid-template-columns":p.join(" "),"grid-template-rows":g.join(" "),"grid-auto-flow":"column"},children:a}}var x=t(0),y={cell:Object(x.css)(O||(O=d(["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;"],["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;"]))),bborder:Object(x.css)(C||(C=d(["\n        border-bottom: 1px solid var(--border_bg);"],["\n        border-bottom: 1px solid var(--border_bg);"]))),tborder:Object(x.css)(E||(E=d(["\n        border-top: 1px solid var(--border_bg);"],["\n        border-top: 1px solid var(--border_bg);"]))),rborder:Object(x.css)(z||(z=d(["\n        border-right: 1px solid var(--border_bg);"],["\n        border-right: 1px solid var(--border_bg);"]))),lborder:Object(x.css)(P||(P=d(["\n        border-left: 1px solid var(--border_bg);"],["\n        border-left: 1px solid var(--border_bg);"]))),scrollbars:Object(x.css)(I||(I=d(["\n        ::-webkit-scrollbar {\n            height: revert;\n        }\n        ::-webkit-scrollbar-corner {\n            background-color: var(--panel_bg);\n        }"],["\n        ::-webkit-scrollbar {\n            height: revert;\n        }\n        ::-webkit-scrollbar-corner {\n            background-color: var(--panel_bg);\n        }"]))),aligns:Object(x.css)(K||(K=d(["\n        &[data-align='l'] {\n            text-align: left;\n        }\n        &[data-align='c'] {\n            text-align: center;\n        }\n        &[data-align='r'] {\n            text-align: right;\n        }"],["\n        &[data-align='l'] {\n            text-align: left;\n        }\n        &[data-align='c'] {\n            text-align: center;\n        }\n        &[data-align='r'] {\n            text-align: right;\n        }"])))},_={namecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(B||(B=d(["\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n            &[data-is_dimension] {\n                top: 0;\n                z-index: 3;\n                padding: 15px 16px 4px 16px;\n            }"],["\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n            &[data-is_dimension] {\n                top: 0;\n                z-index: 3;\n                padding: 15px 16px 4px 16px;\n            }"])))),valuecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(F||(F=d(["\n            text-align: right;\n            &[data-is_dimension] {\n                position: sticky;\n                background-color: var(--panel_bg);\n                top: 0;\n                z-index: 1;\n                padding: 15px 16px 4px 16px;\n                color: var(--hl);\n            }"],["\n            text-align: right;\n            &[data-is_dimension] {\n                position: sticky;\n                background-color: var(--panel_bg);\n                top: 0;\n                z-index: 1;\n                padding: 15px 16px 4px 16px;\n                color: var(--hl);\n            }"])))),grouplabel:Object(x.css)(T||(T=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n\n        padding: 19px 4px 0px 4px;\n        color: var(--hl);\n        display: inline-block;\n        width: auto;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n\n        padding: 19px 4px 0px 4px;\n        color: var(--hl);\n        display: inline-block;\n        width: auto;"])))},w={namecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(N||(N=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;\n\n        &[data-is_dimension] {\n            left: 0;\n            z-index: 3;\n        }"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;\n\n        &[data-is_dimension] {\n            left: 0;\n            z-index: 3;\n        }"])))),valuecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(V||(V=d(["\n        text-align: right;\n        &[data-is_dimension] {\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n        }"],["\n        text-align: right;\n        &[data-is_dimension] {\n            position: sticky;\n            background-color: var(--panel_bg);\n            left: 0;\n            z-index: 2;\n            color: var(--dim);\n        }"])))),grouplabel:Object(x.css)(y.cell,y.lborder,y.rborder,Object(x.css)(M||(M=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        color: var(--hl);\n\n        padding: 8px 4px 0px 4px;\n\n        text-align: center;\n\n        white-space: normal;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        color: var(--hl);\n\n        padding: 8px 4px 0px 4px;\n\n        text-align: center;\n\n        white-space: normal;"]))))};var k,S,j,O,C,E,z,P,I,K,B,F,T,N,V,M,D,G=(k=v.config.theme,S={dim:k.colors.textSemiWeak,hl:k.colors.textBlue,panel_bg:k.colors.panelBg,border_bg:k.colors.border1,dash_bg:k.colors.dashboardBg},j=Object(x.css)(y.scrollbars,Object(x.css)(D||(D=d(["\n        overflow: auto;\n        position: relative;\n        --panel_bg: ",";\n        --dim: ",";\n        --hl: ",";\n        --border_bg: ",";\n        &[data-is_transparent] {\n            --panel_bg: ",";\n        }"],["\n        overflow: auto;\n        position: relative;\n        --panel_bg: ",";\n        --dim: ",";\n        --hl: ",";\n        --border_bg: ",";\n        &[data-is_transparent] {\n            --panel_bg: ",";\n        }"])),S.panel_bg,S.dim,S.hl,S.border_bg,S.dash_bg)),{vertical:o(o({},_),{grid:j}),horizontal:o(o({},w),{grid:j})});function H(n,e){return n&&n.length?function(n,e){var t=/\s*([r|c|l]?)\s*([0-9]*)\s*/,o=n.split(",").map((function(n){var e=n.match(t);return{a:e&&""!=e[1]?e[1]:void 0,w:e&&""!=e[2]?Number.parseInt(e[2]):0}})),r=o.length;r&&r<e&&(o.length=e,o.fill(o[r-1],r));return o}(n,e):[]}var A=u.a.createElement;function R(n,e,t,r){for(var a,l,i,d,s,u,p=t.df,g=t.formatter,v=t.order,b=Object(c.getFieldDisplayName)(n,p),m=r?"":void 0,h=null!==(a=n.display)&&void 0!==a?a:Object(c.getDisplayProcessor)({field:n}),x=e.show_common_unit&&n.type==c.FieldType.number?function(n){var e=n.config.mappings;n.config.mappings=void 0;var t=Object(c.getDisplayProcessor)({field:n})(1).suffix;return n.config.mappings=e,t&&t.length?t:void 0}(n):void 0,y=[A("div",{key:n.name,"data-is_dimension":m,className:t.style.namecell},x?b+", "+x:b)],_=0;_<n.values.length;_++){var w=n.name+"."+_,k=n.values.get(v?v[_]:_);null==k&&(k=void 0);var S=h(k),j={raw:k,i:_,name:n.name,text:e.show_common_unit?S.text:""+(null!==(l=S.prefix)&&void 0!==l?l:"")+S.text+(null!==(i=S.suffix)&&void 0!==i?i:""),style:(s=null===(d=n.config.custom)||void 0===d?void 0:d.display_mode,u=S.color,u?"fg"==s?{color:u}:"bg"==s?{background:u,color:Object(f.getTextColorForBackground)(u)}:{}:{}),html:void 0};if(g)try{g(j,n,{})}catch(n){}var O={key:w,style:j.style,className:t.style.valuecell,"data-is_dimension":m},C=(null==j?void 0:j.html)?A("div",o(o({},O),{dangerouslySetInnerHTML:{__html:j.html}})):A("div",o({},O),j.text);y.push(C)}return{values:y}}function L(n,e){var t=e.sort;if(t.field&&t.field.length){var o=n.find((function(n){return n.name==t.field}));if(o){var r=o.values.toArray().map((function(n,e){return{v:0==n&&t.zeronull?null:n,i:e}}));return o.type==c.FieldType.number?r.sort((function(n,e){return function(n,e,t,o){return null==n&&null==e?0:null==n?t?-1:1:null==e?t?1:-1:o?e-n:n-e}(n.v,e.v,t.nullfirst,t.desc)})):r.sort((function(n,e){return function(n,e,t,o){if(null==n&&null==e)return 0;if(null==n)return t?-1:1;if(null==e)return t?1:-1;if(o){if(n>e)return-1;if(n<e)return 1}else{if(n<e)return-1;if(n>e)return 1}return 0}(n.v,e.v,t.nullfirst,t.desc)})),r.map((function(n){return n.i}))}}}t.d(e,"plugin",(function(){return Q}));var U=[{kind:f.CodeEditorSuggestionItemKind.Field,label:"value"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.text"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.style"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.html"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"value.raw"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"value.name"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"value.i"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"field"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"field.name"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"lib"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"lib.moment"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"context"},{kind:f.CodeEditorSuggestionItemKind.Constant,label:"context.df"}];function W(n){var e=n.value,t=n.onChange;return u.a.createElement(f.CodeEditor,{value:e,onBlur:t,onSave:t,language:"javascript",showMiniMap:!1,showLineNumbers:!0,getSuggestions:function(){return U},height:400})}var q=function(n){return r(void 0,void 0,void 0,(function(){var e,t,o;return a(this,(function(r){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0],o=[],t.fields.filter((function(n){return n.labels})).forEach((function(n){return Object.entries(n.labels).forEach((function(n){var e=l(n,2),t=e[0],r=e[1];null==t||null==r||o.includes(t)||o.push(t)}))})),o.forEach((function(n){return e.push({label:n,value:n})}))),[2,Promise.resolve(e)]}))}))},J=function(n){return r(void 0,void 0,void 0,(function(){var e,t;return a(this,(function(o){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0]).fields.forEach((function(n){var o=Object(c.getFieldDisplayName)(n,t);e.push({label:o!=n.name?o+" ("+n.name+")":n.name,value:n.name})})),[2,Promise.resolve(e)]}))}))},Q=new c.PanelPlugin((function(n){var e,t,r=n.data,a=n.options,d=n.height,s=n.width,u=n.transparent;if(!(r.series&&r.series.length&&(null===(t=null===(e=r.series[0])||void 0===e?void 0:e.fields)||void 0===t?void 0:t.length)))return A("div",null,"No data");var c,f=r.series[0],p=f.fields,b=a.is_horizontal?G.horizontal:G.vertical,x=function(n){var e;return Math.max(n.length,null!==(e=(null==n?void 0:n[0].values.length)+1)&&void 0!==e?e:1)}(p),y=H(a.custom_columns,x);if(v.config.disableSanitizeHtml&&a.use_formatcode&&a.formatcode)try{var _=Function("value","field","context","lib",a.formatcode);c=function(n,e,t){return _(n,e,o({df:f},t),{moment:g.a})}}catch(n){}var w={formatter:c,df:f,style:b,order:L(p,a)},k=function(n,e,t){return n.map((function(n){var o="__group."+(null==n?void 0:n.name);return{label:n.name?A("div",{key:o,className:t.style.grouplabel},n.name):void 0,fields:n.fields.map((function(o){return R(o,e,t,n.is_dim)}))}}))}(function(n,e,t){var o,r=[];if(e&&e.length){var a=n.find((function(n){return n.name==e}));a&&(r.push({fields:[a],is_dim:!0}),n=n.filter((function(n){return n!=a})))}if(t&&t.length){var d=new Map;d.set(void 0,[]),n.forEach((function(n){var e,o,r=null===(e=null==n?void 0:n.labels)||void 0===e?void 0:e[t];d.has(r)||d.set(r,[]),null===(o=d.get(r))||void 0===o||o.push(n)})),(null===(o=d.get(void 0))||void 0===o?void 0:o.length)||d.delete(void 0),r.push.apply(r,i(i(d).map((function(n){var e=l(n,2);return{name:e[0],fields:e[1]}}))))}else r.push({fields:n});return r}(p,a.dimension_field,a.group_by_label),a,w),S=y.map((function(n){return n.a?{"data-align":n.a}:void 0})),j=(a.is_horizontal?h:m)(k,{colws:y.length?y.map((function(n){return n.w})):void 0,colattrs:S.length?S:void 0});return A("div",{style:{width:s,height:d,display:"flex","flex-direction":"column"}},A("div",o({className:b.grid,"data-is_transparent":u?"":void 0},j)))}));Q.setPanelOptions((function(n){n.addSelect({path:"dimension_field",name:"Dimension field name",settings:{allowCustomValue:!0,options:[],getOptions:J},defaultValue:""}).addBooleanSwitch({path:"is_horizontal",name:"Horizontal layout ",defaultValue:!1}).addBooleanSwitch({path:"show_common_unit",name:"Show common unit",defaultValue:!0}).addSelect({path:"group_by_label",name:"Group by label",settings:{allowCustomValue:!0,options:[],getOptions:q},defaultValue:""}).addTextInput({path:"custom_columns",name:"Custom column widths and text alignments",description:"Comma-separated format string: r100, c200, l300, etc"}).addSelect({path:"sort.field",name:"By field",settings:{allowCustomValue:!0,options:[],getOptions:J},defaultValue:"",category:["Sort"]}).addBooleanSwitch({path:"sort.desc",name:"Descending",category:["Sort"]}).addBooleanSwitch({path:"sort.zeronull",name:"Treat zeros as nulls",category:["Sort"]}).addBooleanSwitch({path:"sort.nullfirst",name:"Nulls go first",category:["Sort"]}).addBooleanSwitch({path:"use_formatcode",name:"Use formatting code (DANGER!)",description:v.config.disableSanitizeHtml?"":"Feature is disabled. Set disable_sanitize_html = false in Grafana config to activate it.",category:["Custom formatting"],defaultValue:!1}).addCustomEditor({id:"formatcode",path:"formatcode",name:"Code",showIf:function(n){return n.use_formatcode&&v.config.disableSanitizeHtml},category:["Custom formatting"],editor:W,defaultValue:"\n/*\n    This code would be called for formatting each value.\n    The object 'value' is in scope for modification.\n\n    Set the text:\n      value.text = 'foo'\n    Set the style:\n      value.style = {'color': 'red', 'border': '1px solid'}\n    Render as html instead of text:\n      value.html = '<a href=\"http://www.grafana.com\">Go to base</a>'\n    Get raw (numeric) value:\n      let a = value.raw\n\n    Extra objects are in scope to help the formatting:\n      field: dataframe field of this value. The field.name is most useful here.\n      context.df: whole dataframe\n      lib.moment: moment.js library, handy for the datetimes.\n*/\n\nvalue.text = field.name + ':' + value.raw\nvalue.style = {'color': 'red'}"})})),Q.useFieldConfig({useCustomConfig:function(n){n.addRadio({path:"display_mode",name:"Cell display mode",settings:{options:[{value:"auto",label:"Auto"},{value:"fg",label:"Color text"},{value:"bg",label:"Color background"}]},defaultValue:"auto"})}})}])}));
//# sourceMappingURL=module.js.map