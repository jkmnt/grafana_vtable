define(["emotion","@grafana/ui","react","@grafana/data","@grafana/runtime","moment"],(function(n,e,t,o,r,l){return function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/",t(t.s=6)}([function(e,t){e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=t},function(n,e){n.exports=o},function(n,e){n.exports=r},function(n,e){n.exports=l},function(n,e,t){"use strict";t.r(e);var o=function(){return(o=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};function r(n,e,t,o){return new(t||(t=Promise))((function(r,l){function a(n){try{d(o.next(n))}catch(n){l(n)}}function i(n){try{d(o.throw(n))}catch(n){l(n)}}function d(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,i)}d((o=o.apply(n,e||[])).next())}))}function l(n,e){var t,o,r,l,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){a.label=l[1];break}if(6===l[0]&&a.label<r[1]){a.label=r[1],r=l;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(l);break}r[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(n,a)}catch(n){l=[6,n],o=0}finally{t=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}}function a(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,r,l=t.call(n),a=[];try{for(;(void 0===e||e-- >0)&&!(o=l.next()).done;)a.push(o.value)}catch(n){r={error:n}}finally{try{o&&!o.done&&(t=l.return)&&t.call(l)}finally{if(r)throw r.error}}return a}function i(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(a(arguments[e]));return n}function d(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var c=t(2),s=t.n(c),u=t(3),p=t(1),f=t(5),g=t.n(f),b=t(4);function v(n,e,t){var o=Array(e).fill(t);if(!n||!n.length)return o;for(var r=0;r<e;r++){var l=n[r];l&&l>0&&(o[r]=l+"px")}return o}function m(n,e){var t,r;void 0===e&&(e={});var l=[],a=null!==(r=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==r?r:0,d=0;n.forEach((function(n){var t;if(n.label){var r=s.a.cloneElement(n.label,{style:o(o({},null===(t=n.label.props)||void 0===t?void 0:t.style),{"grid-column":"1 / -1"})});l.push(r),d+=1}n.fields.forEach((function(n){return l.push.apply(l,i(n.values.map((function(n,t){var o,r=null===(o=null==e?void 0:e.colattrs)||void 0===o?void 0:o[t];return r?s.a.cloneElement(n,r):n}))))})),d+=n.fields.length}));var c=v(e.colws,a,"minmax(max-content, 1fr)"),u=v(e.rowhs,d,"max-content");return{style:{display:"grid","grid-template-columns":c.join(" "),"grid-template-rows":u.join(" ")},children:l}}function h(n,e){var t,r;void 0===e&&(e={});var l=[],a=n.find((function(n){return n.label})),d=null!==(r=null===(t=n.find((function(n){return n.fields.length})))||void 0===t?void 0:t.fields[0].values.length)&&void 0!==r?r:0;if(a){d+=1;var c=1;n.forEach((function(n){var e,t={"grid-row":"1 / 2","grid-column":c+" / span "+n.fields.length},r=n.label?s.a.cloneElement(n.label,{style:o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),t)}):s.a.createElement("div",{key:"__spacer."+c,style:t});l.push(r),c+=n.fields.length}))}var u=0,p=0;n.forEach((function(n){n.fields.forEach((function(n){var t,o=null===(t=null==e?void 0:e.colattrs)||void 0===t?void 0:t[p++];o?l.push.apply(l,i(n.values.map((function(n){return s.a.cloneElement(n,o)})))):l.push.apply(l,i(n.values))})),u+=n.fields.length}));var f=v(e.colws,u,"auto"),g=v(e.rowhs,d,"max-content");return{style:{display:"grid","grid-template-columns":f.join(" "),"grid-template-rows":g.join(" "),"grid-auto-flow":"column"},children:l}}var x=t(0),y={cell:Object(x.css)(S||(S=d(["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;"],["\n        padding: 9px 16px 9px 16px;\n        white-space: nowrap;"]))),bborder:Object(x.css)(C||(C=d(["\n        border-bottom: 1px solid var(--border_bg);"],["\n        border-bottom: 1px solid var(--border_bg);"]))),tborder:Object(x.css)(E||(E=d(["\n        border-top: 1px solid var(--border_bg);"],["\n        border-top: 1px solid var(--border_bg);"]))),rborder:Object(x.css)(z||(z=d(["\n        border-right: 1px solid var(--border_bg);"],["\n        border-right: 1px solid var(--border_bg);"]))),lborder:Object(x.css)(P||(P=d(["\n        border-left: 1px solid var(--border_bg);"],["\n        border-left: 1px solid var(--border_bg);"]))),scrollbars:Object(x.css)(I||(I=d(["\n        ::-webkit-scrollbar {\n            height: revert;\n        }\n        ::-webkit-scrollbar-corner {\n            background-color: var(--panel_bg);\n        }"],["\n        ::-webkit-scrollbar {\n            height: revert;\n        }\n        ::-webkit-scrollbar-corner {\n            background-color: var(--panel_bg);\n        }"]))),aligns:Object(x.css)(K||(K=d(["\n        &[data-align='l'] {\n            text-align: left;\n        }\n        &[data-align='c'] {\n            text-align: center;\n        }\n        &[data-align='r'] {\n            text-align: right;\n        }"],["\n        &[data-align='l'] {\n            text-align: left;\n        }\n        &[data-align='c'] {\n            text-align: center;\n        }\n        &[data-align='r'] {\n            text-align: right;\n        }"])))},_={namecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(B||(B=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n        color: var(--dim);\n        "],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n        color: var(--dim);\n        "])))),valuecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(F||(F=d(["\n        text-align: right;"],["\n        text-align: right;"])))),dimnamecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(N||(N=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        top: 0;\n        z-index: 3;\n        color: var(--dim);\n        padding: 15px 16px 4px 16px;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        top: 0;\n        z-index: 3;\n        color: var(--dim);\n        padding: 15px 16px 4px 16px;"])))),dimvaluecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(T||(T=d(["\n        text-align: right;\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n        padding: 15px 16px 4px 16px;\n        color: var(--hl);\n        "],["\n        text-align: right;\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n        padding: 15px 16px 4px 16px;\n        color: var(--hl);\n        "])))),grouplabel:Object(x.css)(V||(V=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n\n        padding: 19px 4px 0px 4px;\n        color: var(--hl);\n\n        justify-self: start;\n        "],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n\n        padding: 19px 4px 0px 4px;\n        color: var(--hl);\n\n        justify-self: start;\n        "])))},w={namecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(M||(M=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 1;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;"])))),valuecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(D||(D=d(["\n        text-align: right;"],["\n        text-align: right;"])))),dimnamecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(G||(G=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 3;\n        left: 0;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        z-index: 3;\n        left: 0;\n\n        color: var(--hl);\n\n        padding: 7px 16px 4px 16px;\n\n        text-align: right;\n        white-space: normal;"])))),dimvaluecell:Object(x.css)(y.cell,y.bborder,y.aligns,Object(x.css)(H||(H=d(["\n        text-align: right;\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n        color: var(--dim);"],["\n        text-align: right;\n        position: sticky;\n        background-color: var(--panel_bg);\n        left: 0;\n        z-index: 2;\n        color: var(--dim);"])))),grouplabel:Object(x.css)(y.cell,y.lborder,y.rborder,Object(x.css)(A||(A=d(["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        color: var(--hl);\n\n        padding: 8px 4px 0px 4px;\n\n        text-align: center;\n\n        white-space: normal;"],["\n        position: sticky;\n        background-color: var(--panel_bg);\n        top: 0;\n        color: var(--hl);\n\n        padding: 8px 4px 0px 4px;\n\n        text-align: center;\n\n        white-space: normal;"]))))};var k,j,O,S,C,E,z,P,I,K,B,F,N,T,V,M,D,G,H,A,R,L=(k=b.config.theme,j={dim:k.colors.textSemiWeak,hl:k.colors.textBlue,panel_bg:k.colors.panelBg,border_bg:k.colors.border1,dash_bg:k.colors.dashboardBg},O=Object(x.css)(y.scrollbars,Object(x.css)(R||(R=d(["\n        overflow: auto;\n\n        --panel_bg: ",";\n        --dim: ",";\n        --hl: ",";\n        --border_bg: ",";\n        &[data-is_transparent] {\n            --panel_bg: ",";\n        }\n        "],["\n        overflow: auto;\n\n        --panel_bg: ",";\n        --dim: ",";\n        --hl: ",";\n        --border_bg: ",";\n        &[data-is_transparent] {\n            --panel_bg: ",";\n        }\n        "])),j.panel_bg,j.dim,j.hl,j.border_bg,j.dash_bg)),{vertical:o(o({},_),{container:O}),horizontal:o(o({},w),{container:O})});function U(n,e){return n&&n.length?function(n,e){var t=/\s*([r|c|l]?)\s*([0-9]*)\s*/,o=n.split(",").map((function(n){var e=n.match(t);return{a:e&&""!=e[1]?e[1]:void 0,w:e&&""!=e[2]?Number.parseInt(e[2]):0}})),r=o.length;r&&r<e&&(o.length=e,o.fill(o[r-1],r));return o}(n,e):[]}var W=s.a.createElement;function q(n,e,t,r){for(var l,a,i,d,c,s,f=t.df,g=t.formatter,b=t.order,v=Object(u.getFieldDisplayName)(n,f),m=null!==(l=n.display)&&void 0!==l?l:Object(u.getDisplayProcessor)({field:n}),h=e.show_common_unit&&n.type==u.FieldType.number?function(n){var e=n.config.mappings;n.config.mappings=void 0;var t=Object(u.getDisplayProcessor)({field:n})(1).suffix;return n.config.mappings=e,t&&t.length?t:void 0}(n):void 0,x=[W("div",{key:n.name,className:r?t.style.dimnamecell:t.style.namecell},h?v+", "+h:v)],y=0;y<n.values.length;y++){var _=n.name+"."+y,w=n.values.get(b?b[y]:y);null==w&&(w=void 0);var k=m(w),j={raw:w,i:y,name:n.name,text:e.show_common_unit?k.text:""+(null!==(a=k.prefix)&&void 0!==a?a:"")+k.text+(null!==(i=k.suffix)&&void 0!==i?i:""),style:(c=null===(d=n.config.custom)||void 0===d?void 0:d.display_mode,s=k.color,s?"fg"==c?{color:s}:"bg"==c?{background:s,color:Object(p.getTextColorForBackground)(s)}:{}:{}),html:void 0};if(g)try{g(j,n,{})}catch(n){}var O={key:_,style:j.style,className:r?t.style.dimvaluecell:t.style.valuecell},S=(null==j?void 0:j.html)?W("div",o(o({},O),{dangerouslySetInnerHTML:{__html:j.html}})):W("div",o({},O),j.text);x.push(S)}return{values:x}}function J(n,e){var t=e.sort;if(t.field&&t.field.length){var o=n.find((function(n){return n.name==t.field}));if(o){var r=o.values.toArray().map((function(n,e){return{v:0==n&&t.zeronull?null:n,i:e}}));return o.type==u.FieldType.number?r.sort((function(n,e){return function(n,e,t,o){return null==n&&null==e?0:null==n?t?-1:1:null==e?t?1:-1:o?e-n:n-e}(n.v,e.v,t.nullfirst,t.desc)})):r.sort((function(n,e){return function(n,e,t,o){if(null==n&&null==e)return 0;if(null==n)return t?-1:1;if(null==e)return t?1:-1;if(o){if(n>e)return-1;if(n<e)return 1}else{if(n<e)return-1;if(n>e)return 1}return 0}(n.v,e.v,t.nullfirst,t.desc)})),r.map((function(n){return n.i}))}}}t.d(e,"plugin",(function(){return $}));var Q=[{kind:p.CodeEditorSuggestionItemKind.Field,label:"value"},{kind:p.CodeEditorSuggestionItemKind.Property,label:"value.text"},{kind:p.CodeEditorSuggestionItemKind.Property,label:"value.style"},{kind:p.CodeEditorSuggestionItemKind.Property,label:"value.html"},{kind:p.CodeEditorSuggestionItemKind.Constant,label:"value.raw"},{kind:p.CodeEditorSuggestionItemKind.Constant,label:"value.name"},{kind:p.CodeEditorSuggestionItemKind.Constant,label:"value.i"},{kind:p.CodeEditorSuggestionItemKind.Field,label:"field"},{kind:p.CodeEditorSuggestionItemKind.Constant,label:"field.name"},{kind:p.CodeEditorSuggestionItemKind.Field,label:"lib"},{kind:p.CodeEditorSuggestionItemKind.Property,label:"lib.moment"},{kind:p.CodeEditorSuggestionItemKind.Field,label:"context"},{kind:p.CodeEditorSuggestionItemKind.Constant,label:"context.df"}];function X(n){var e=n.value,t=n.onChange;return s.a.createElement(p.CodeEditor,{value:e,onBlur:t,onSave:t,language:"javascript",showMiniMap:!1,showLineNumbers:!0,getSuggestions:function(){return Q},height:400})}var Y=function(n){return r(void 0,void 0,void 0,(function(){var e,t,o;return l(this,(function(r){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0],o=[],t.fields.filter((function(n){return n.labels})).forEach((function(n){return Object.entries(n.labels).forEach((function(n){var e=a(n,2),t=e[0],r=e[1];null==t||null==r||o.includes(t)||o.push(t)}))})),o.forEach((function(n){return e.push({label:n,value:n})}))),[2,Promise.resolve(e)]}))}))},Z=function(n){return r(void 0,void 0,void 0,(function(){var e,t;return l(this,(function(o){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0]).fields.forEach((function(n){var o=Object(u.getFieldDisplayName)(n,t);e.push({label:o!=n.name?o+" ("+n.name+")":n.name,value:n.name})})),[2,Promise.resolve(e)]}))}))},$=new u.PanelPlugin((function(n){var e,t,r=n.data,l=n.options,d=n.height,c=n.width,s=n.transparent;if(!(r.series&&r.series.length&&(null===(t=null===(e=r.series[0])||void 0===e?void 0:e.fields)||void 0===t?void 0:t.length)))return W("div",null,"No data");var u,p=r.series[0],f=p.fields,v=l.is_horizontal?L.horizontal:L.vertical,x=function(n){var e;return Math.max(n.length,null!==(e=(null==n?void 0:n[0].values.length)+1)&&void 0!==e?e:1)}(f),y=U(l.custom_columns,x);if(b.config.disableSanitizeHtml&&l.use_formatcode&&l.formatcode)try{var _=Function("value","field","context","lib",l.formatcode);u=function(n,e,t){return _(n,e,o({df:p},t),{moment:g.a})}}catch(n){}var w={formatter:u,df:p,style:v,order:J(f,l)},k=function(n,e,t){return n.map((function(n){var o="__group."+(null==n?void 0:n.name);return{label:n.name?W("div",{key:o,className:t.style.grouplabel},n.name):void 0,fields:n.fields.map((function(o){return q(o,e,t,n.is_dim)}))}}))}(function(n,e,t){var o,r=[];if(e&&e.length){var l=n.find((function(n){return n.name==e}));l&&(r.push({fields:[l],is_dim:!0}),n=n.filter((function(n){return n!=l})))}if(t&&t.length){var d=new Map;d.set(void 0,[]),n.forEach((function(n){var e,o,r=null===(e=null==n?void 0:n.labels)||void 0===e?void 0:e[t];d.has(r)||d.set(r,[]),null===(o=d.get(r))||void 0===o||o.push(n)})),(null===(o=d.get(void 0))||void 0===o?void 0:o.length)||d.delete(void 0),r.push.apply(r,i(i(d).map((function(n){var e=a(n,2);return{name:e[0],fields:e[1]}}))))}else r.push({fields:n});return r}(f,l.dimension_field,l.group_by_label),l,w),j=y.map((function(n){return n.a?{"data-align":n.a}:void 0})),O=(l.is_horizontal?h:m)(k,{colws:y.length?y.map((function(n){return n.w})):void 0,colattrs:j.length?j:void 0});return W("div",{style:{width:c,height:d,display:"flex","flex-direction":"column"}},W("div",{className:v.container,"data-is_transparent":s?"":void 0},W("div",o({className:v.grid},O))))}));$.setPanelOptions((function(n){n.addSelect({path:"dimension_field",name:"Dimension field name",settings:{allowCustomValue:!0,options:[],getOptions:Z},defaultValue:""}).addBooleanSwitch({path:"is_horizontal",name:"Horizontal layout ",defaultValue:!1}).addBooleanSwitch({path:"show_common_unit",name:"Show common unit",defaultValue:!0}).addSelect({path:"group_by_label",name:"Group by label",settings:{allowCustomValue:!0,options:[],getOptions:Y},defaultValue:""}).addTextInput({path:"custom_columns",name:"Custom column widths and text alignments",description:"Comma-separated format string: r100, c200, l300, etc"}).addSelect({path:"sort.field",name:"By field",settings:{allowCustomValue:!0,options:[],getOptions:Z},defaultValue:"",category:["Sort"]}).addBooleanSwitch({path:"sort.desc",name:"Descending",category:["Sort"]}).addBooleanSwitch({path:"sort.zeronull",name:"Treat zeros as nulls",category:["Sort"]}).addBooleanSwitch({path:"sort.nullfirst",name:"Nulls go first",category:["Sort"]}).addBooleanSwitch({path:"use_formatcode",name:"Use formatting code (DANGER!)",description:b.config.disableSanitizeHtml?"":"Feature is disabled. Set disable_sanitize_html = false in Grafana config to activate it.",category:["Custom formatting"],defaultValue:!1}).addCustomEditor({id:"formatcode",path:"formatcode",name:"Code",showIf:function(n){return n.use_formatcode&&b.config.disableSanitizeHtml},category:["Custom formatting"],editor:X,defaultValue:"\n/*\n    This code would be called for formatting each value.\n    The object 'value' is in scope for modification.\n\n    Set the text:\n      value.text = 'foo'\n    Set the style:\n      value.style = {'color': 'red', 'border': '1px solid'}\n    Render as html instead of text:\n      value.html = '<a href=\"http://www.grafana.com\">Go to base</a>'\n    Get raw (numeric) value:\n      let a = value.raw\n\n    Extra objects are in scope to help the formatting:\n      field: dataframe field of this value. The field.name is most useful here.\n      context.df: whole dataframe\n      lib.moment: moment.js library, handy for the datetimes.\n*/\n\nvalue.text = field.name + ':' + value.raw\nvalue.style = {'color': 'red'}"})})),$.useFieldConfig({useCustomConfig:function(n){n.addRadio({path:"display_mode",name:"Cell display mode",settings:{options:[{value:"auto",label:"Auto"},{value:"fg",label:"Color text"},{value:"bg",label:"Color background"}]},defaultValue:"auto"})}})}])}));
//# sourceMappingURL=module.js.map