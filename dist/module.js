define(["emotion","@grafana/ui","react","@grafana/data","moment"],(function(n,e,t,o,r){return function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="/",t(t.s=5)}([function(e,t){e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=t},function(n,e){n.exports=o},function(n,e){n.exports=r},function(n,e,t){"use strict";t.r(e);var o=function(){return(o=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};function r(n,e,t,o){return new(t||(t=Promise))((function(r,i){function l(n){try{u(o.next(n))}catch(n){i(n)}}function a(n){try{u(o.throw(n))}catch(n){i(n)}}function u(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(l,a)}u((o=o.apply(n,e||[])).next())}))}function i(n,e){var t,o,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(r=l.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){l.label=i[1];break}if(6===i[0]&&l.label<r[1]){l.label=r[1],r=i;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(i);break}r[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(n,l)}catch(n){i=[6,n],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function l(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var o,r,i=t.call(n),l=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)l.push(o.value)}catch(n){r={error:n}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(r)throw r.error}}return l}function a(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(l(arguments[e]));return n}function u(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var d=t(2),s=t.n(d),c=t(3),f=t(1),p=t(4),g=t.n(p),m=t(0);function v(n,e,t){var o=Array(e).fill(t);if(!n||!n.length)return o;for(var r=0;r<e;r++){var i=n[r];i&&i>0&&(o[r]=i+"px")}return o}function h(n){var e,t,r=n.groups,i=[],l=null!==(t=null===(e=r.find((function(n){return n.fields.length})))||void 0===e?void 0:e.fields[0].values.length)&&void 0!==t?t:0,u=0;r.forEach((function(n){var e;if(n.label){var t=o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),{"grid-column":"1 / span "+l,"justify-self":"start"});i.push(s.a.cloneElement(n.label,{style:t}))}n.fields.forEach((function(n){return i.push.apply(i,a(n.values))})),u+=n.fields.length}));var d=v(n.colws,l,"minmax(max-content, 1fr)"),c=v(n.rowhs,u,"max-content"),f={display:"grid","grid-template-columns":d.join(" "),"grid-template-rows":c.join(" ")};return s.a.createElement("div",{style:f,className:n.className},i)}function b(n){var e,t,r=n.groups,i=[],l=r.find((function(n){return n.label})),u=null!==(t=null===(e=r.find((function(n){return n.fields.length})))||void 0===e?void 0:e.fields[0].values.length)&&void 0!==t?t:0;if(l){u+=1;var d=1;r.forEach((function(n){var e,t={"grid-row":"1 / 2","grid-column":d+" / span "+n.fields.length},r=n.label?s.a.cloneElement(n.label,{style:o(o({},null===(e=n.label.props)||void 0===e?void 0:e.style),t)}):s.a.createElement("div",{style:t});i.push(r),d+=n.fields.length}))}var c=0;r.forEach((function(n){n.fields.forEach((function(n){i.push.apply(i,a(n.values))})),c+=n.fields.length}));var f=v(n.colws,c,"auto"),p=v(n.rowhs,u,"max-content"),g={display:"grid","grid-template-columns":f.join(" "),"grid-template-rows":p.join(" "),"grid-auto-flow":"column"};return s.a.createElement("div",{style:g,className:n.className},i)}function y(n){var e=Object(f.useTheme)();return n?function(n){var e=n.colors.textWeak,t=n.colors.textBlue,o=n.colors.panelBg,r=n.colors.border1;return{field:{name:Object(m.css)(S||(S=u(["\n                position: sticky;\n                top: 0;\n                z-index: 1;\n\n                padding: 8px;\n\n                color: ",";\n\n                border-right: 1px solid ",";\n                background-color: ",";\n\n                text-align: right;\n            "],["\n                position: sticky;\n                top: 0;\n                z-index: 1;\n\n                padding: 8px;\n\n                color: ",";\n\n                border-right: 1px solid ",";\n                background-color: ",";\n\n                text-align: right;\n            "])),t,r,o),value:Object(m.css)(_||(_=u(["\n                padding: 8px;\n\n                text-align: right;\n\n                border-bottom: 1px solid ",";\n                white-space: nowrap;\n            "],["\n                padding: 8px;\n\n                text-align: right;\n\n                border-bottom: 1px solid ",";\n                white-space: nowrap;\n            "])),r)},dimfield:{name:Object(m.css)(E||(E=u(["\n                position: sticky;\n                top: 0;\n                left: 0;\n                z-index: 3;\n\n                padding: 8px;\n\n                color: ",";\n                background-color: ",";\n\n                text-align: right;\n            "],["\n                position: sticky;\n                top: 0;\n                left: 0;\n                z-index: 3;\n\n                padding: 8px;\n\n                color: ",";\n                background-color: ",";\n\n                text-align: right;\n            "])),t,o),value:Object(m.css)(C||(C=u(["\n                position: sticky;\n                left: 0;\n                z-index: 2;\n\n                padding: 8px;\n\n                color: ",";\n                background-color: ",";\n\n                border-bottom: 1px solid ",";\n\n                text-align: right;\n\n                white-space: nowrap;\n            "],["\n                position: sticky;\n                left: 0;\n                z-index: 2;\n\n                padding: 8px;\n\n                color: ",";\n                background-color: ",";\n\n                border-bottom: 1px solid ",";\n\n                text-align: right;\n\n                white-space: nowrap;\n            "])),e,o,r)},grouplabel:Object(m.css)(P||(P=u(["\n            position: sticky;\n            top: 0;\n            padding: 8px;\n\n            color: ",";\n            border-right: 1px solid ",";\n            background-color: ",";\n\n            text-align: center;\n        "],["\n            position: sticky;\n            top: 0;\n            padding: 8px;\n\n            color: ",";\n            border-right: 1px solid ",";\n            background-color: ",";\n\n            text-align: center;\n        "])),t,r,o)}}(e):function(n){var e=n.colors.textWeak,t=n.colors.textBlue,o=n.colors.panelBg,r=n.colors.border1;return{field:{name:Object(m.css)(x||(x=u(["\n                position: sticky;\n                left: 0;\n                z-index: 2;\n\n                padding: 8px;\n                background-color: ",";\n                color: ",";\n\n                border-bottom: 1px solid ",";\n\n                white-space: nowrap;\n            "],["\n                position: sticky;\n                left: 0;\n                z-index: 2;\n\n                padding: 8px;\n                background-color: ",";\n                color: ",";\n\n                border-bottom: 1px solid ",";\n\n                white-space: nowrap;\n            "])),o,e,r),value:Object(m.css)(w||(w=u(["\n                padding: 8px;\n\n                text-align: right;\n\n                border-bottom: 1px solid ",";\n\n                white-space: nowrap;\n            "],["\n                padding: 8px;\n\n                text-align: right;\n\n                border-bottom: 1px solid ",";\n\n                white-space: nowrap;\n            "])),r)},dimfield:{name:Object(m.css)(k||(k=u(["\n                position: sticky;\n                top: 0;\n                z-index: 3;\n\n                left: 0;\n                padding: 8px;\n                background-color: ",";\n                color: ",";\n\n                white-space: nowrap;\n            "],["\n                position: sticky;\n                top: 0;\n                z-index: 3;\n\n                left: 0;\n                padding: 8px;\n                background-color: ",";\n                color: ",";\n\n                white-space: nowrap;\n            "])),o,e),value:Object(m.css)(j||(j=u(["\n                position: sticky;\n                top: 0;\n                z-index: 1;\n\n                padding: 8px;\n                background-color: ",";\n                color: ",";\n\n                text-align: right;\n\n                white-space: nowrap;\n            "],["\n                position: sticky;\n                top: 0;\n                z-index: 1;\n\n                padding: 8px;\n                background-color: ",";\n                color: ",";\n\n                text-align: right;\n\n                white-space: nowrap;\n            "])),o,t)},grouplabel:Object(m.css)(O||(O=u(["\n            position: sticky;\n            left: 0;\n            z-index: 2;\n\n            padding: 16px 8px 0 4px;\n            background-color: ",";\n            color: ",";\n        "],["\n            position: sticky;\n            left: 0;\n            z-index: 2;\n\n            padding: 16px 8px 0 4px;\n            background-color: ",";\n            color: ",";\n        "])),o,t)}}(e)}var x,w,k,j,O,S,_,E,C,P,z,N,I,B,T={l:Object(m.css)(z||(z=u(["text-align: left;"],["text-align: left;"]))),c:Object(m.css)(N||(N=u(["text-align: center;"],["text-align: center;"]))),r:Object(m.css)(I||(I=u(["text-align: right;"],["text-align: right;"])))},F=s.a.createElement;function K(n,e,t,o){var r=0;return n.map((function(n){return{label:n.name?F("div",{key:"__group."+n.name,className:t.style.grouplabel},n.name):void 0,fields:n.fields.map((function(i){return function(n,e,t,o){var r,i,l,a=t.df,u=t.formatter,d=t.order,s=Object(c.getFieldDisplayName)(n,a);n.display||(n.display=Object(c.getDisplayProcessor)({field:n}));var p=void 0;if(e.show_common_unit&&n.type==c.FieldType.number){var g=n.config.mappings;n.config.mappings=void 0,p=Object(c.getDisplayProcessor)({field:n})(1).suffix,n.config.mappings=g}for(var m,v,h=[F("div",{key:n.name,className:o.name},p?s+", "+p:s)],b=0;b<n.values.length;b++){var y=n.name+"."+b,x=n.values.get(d?d[b]:b);null==x&&(x=void 0);var w=n.display(x),k={raw:x,i:b,text:e.show_common_unit?w.text:""+(null!==(r=w.prefix)&&void 0!==r?r:"")+w.text+(null!==(i=w.suffix)&&void 0!==i?i:""),style:(m=null===(l=n.config.custom)||void 0===l?void 0:l.display_mode,v=w.color,v?"fg"==m?{color:v}:"bg"==m?{background:v,color:Object(f.getTextColorForBackground)(v)}:{}:{}),html:void 0};if(u)try{u(k,n,{})}catch(n){}var j=void 0;j=(null==k?void 0:k.html)?F("div",{key:y,style:k.style,className:o.value(b),dangerouslySetInnerHTML:{__html:k.html}}):F("div",{key:y,style:k.style,className:o.value(b)},k.text),h.push(j)}return{values:h}}(i,e,t,function(n,r){var i=r?t.style.dimfield:t.style.field;return e.is_horizontal?{name:Object(m.css)(i.name,o[n]),value:function(e){return Object(m.css)(i.value,o[n])}}:{name:Object(m.css)(i.name,o[0]),value:function(n){return Object(m.css)(i.value,o[n+1])}}}(r++,!!n.is_dim))}))}}))}function V(n,e){var t=e.sort;if(t.field&&t.field.length){var o=n.find((function(n){return n.name==t.field}));if(o){var r=o.values.toArray().map((function(n,e){return{v:0==n&&t.zeronull?null:n,i:e}}));return o.type==c.FieldType.number?r.sort((function(n,e){return function(n,e,t,o){return null==n&&null==e?0:null==n?t?-1:1:null==e?t?1:-1:o?e-n:n-e}(n.v,e.v,t.nullfirst,t.desc)})):r.sort((function(n,e){return function(n,e,t,o){if(null==n&&null==e)return 0;if(null==n)return t?-1:1;if(null==e)return t?1:-1;if(o){if(n>e)return-1;if(n<e)return 1}else{if(n<e)return-1;if(n>e)return 1}return 0}(n.v,e.v,t.nullfirst,t.desc)})),r.map((function(n){return n.i}))}}}function M(n,e){return n&&n.length?(t=e,o=/\s*([r|c|l]?)\s*([0-9]*)\s*/,r=n.split(",").map((function(n){var e=n.match(o);return{a:e?T[e[1]]:void 0,w:e&&e[2].length?Number.parseInt(e[2]):0}})),(i=r.length)&&i<t&&(r.length=t,r.fill(r[i-1],i)),r):[];var t,o,r,i}t.d(e,"plugin",(function(){return H}));var D=[{kind:f.CodeEditorSuggestionItemKind.Field,label:"value"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.raw"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.text"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.style"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"value.html"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"field"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"field.name"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"lib"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"lib.moment"},{kind:f.CodeEditorSuggestionItemKind.Field,label:"context"},{kind:f.CodeEditorSuggestionItemKind.Property,label:"context.df"}];function G(n){var e=n.value,t=n.onChange;return s.a.createElement(f.CodeEditor,{value:e,onBlur:t,onSave:t,language:"javascript",showMiniMap:!1,showLineNumbers:!0,getSuggestions:function(){return D},height:400})}var A=function(n){return r(void 0,void 0,void 0,(function(){var e,t,o;return i(this,(function(r){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0],o=[],t.fields.filter((function(n){return n.labels})).forEach((function(n){return Object.entries(n.labels).forEach((function(n){var e=l(n,2),t=e[0],r=e[1];null==t||null==r||o.includes(t)||o.push(t)}))})),o.forEach((function(n){return e.push({label:n,value:n})}))),[2,Promise.resolve(e)]}))}))},R=function(n){return r(void 0,void 0,void 0,(function(){var e,t;return i(this,(function(o){return e=[{value:"",label:"─"}],n&&n.data&&n.data.length&&(t=n.data[0]).fields.forEach((function(n){var o=Object(c.getFieldDisplayName)(n,t);e.push({label:o!=n.name?o+" ("+n.name+")":n.name,value:n.name})})),[2,Promise.resolve(e)]}))}))},H=new c.PanelPlugin((function(n){var e,t,r=n.data,i=n.options,d=n.height,s=n.width;if(!(r.series&&r.series.length&&(null===(t=null===(e=r.series[0])||void 0===e?void 0:e.fields)||void 0===t?void 0:t.length)))return F("div",null,"No data");var c,f=r.series[0],p=f.fields,v=y(!!i.is_horizontal),x=function(n){var e;return Math.max(n.length,null!==(e=(null==n?void 0:n[0].values.length)+1)&&void 0!==e?e:1)}(p),w=M(i.custom_columns,x);if(i.use_formatcode&&i.formatcode)try{var k=Function("value","field","context","lib",i.formatcode);c=function(n,e,t){return k(n,e,o({df:f},t),{moment:g.a})}}catch(n){}var j={formatter:c,df:f,style:v,order:V(p,i)},O=K(function(n,e){var t,o=e.dimension_field,r=e.group_by_label,i=[];if(o&&o.length){var u=n.find((function(n){return n.name==o}));u&&(i.push({fields:[u],is_dim:!0}),n=n.filter((function(n){return n!=u})))}if(r&&r.length){var d=new Map;d.set(void 0,[]),n.forEach((function(n){var e,t,o=null===(e=null==n?void 0:n.labels)||void 0===e?void 0:e[r];d.has(o)||d.set(o,[]),null===(t=d.get(o))||void 0===t||t.push(n)})),(null===(t=d.get(void 0))||void 0===t?void 0:t.length)||d.delete(void 0),i.push.apply(i,a(a(d).map((function(n){var e=l(n,2);return{name:e[0],fields:e[1]}}))))}else i.push({fields:n});return i}(p,i),i,j,w.map((function(n){return n.a})));return F(i.is_horizontal?b:h,{className:Object(m.css)(B||(B=u(["\n                width: ","px;\n                height: ","px;\n                overflow: auto;\n              "],["\n                width: ","px;\n                height: ","px;\n                overflow: auto;\n              "])),s,d),groups:O,colws:w.length?w.map((function(n){return n.w})):void 0})}));H.setPanelOptions((function(n){n.addSelect({path:"dimension_field",name:"Dimension field name",settings:{allowCustomValue:!0,options:[],getOptions:R},defaultValue:""}).addBooleanSwitch({path:"is_horizontal",name:"Horizontal layout ",defaultValue:!1}).addBooleanSwitch({path:"show_common_unit",name:"Show common unit",defaultValue:!0}).addSelect({path:"group_by_label",name:"Group by label",settings:{allowCustomValue:!0,options:[],getOptions:A},defaultValue:""}).addTextInput({path:"custom_columns",name:"Custom column widths and text alignments",description:"Comma-separated format string: r100, c200, l300, etc"}).addSelect({path:"sort.field",name:"By field",settings:{allowCustomValue:!0,options:[],getOptions:R},defaultValue:"",category:["Sort"]}).addBooleanSwitch({path:"sort.desc",name:"Descending",category:["Sort"]}).addBooleanSwitch({path:"sort.zeronull",name:"Treat zeros as nulls",category:["Sort"]}).addBooleanSwitch({path:"sort.nullfirst",name:"Nulls go first",category:["Sort"]}).addBooleanSwitch({path:"use_formatcode",name:"Use formatting code (DANGER!)",category:["Custom formatting"],defaultValue:!1}).addCustomEditor({id:"formatcode",path:"formatcode",name:"Code",showIf:function(n){return n.use_formatcode},category:["Custom formatting"],editor:G,defaultValue:"\n/*\n    This code would be called for formatting each value.\n    The object 'value' is in scope for modification.\n\n    Set the text:\n      value.text = 'foo'\n    Set the style:\n      value.style = {'color': 'red', 'border': '1px solid'}\n    Render as html instead of text:\n      value.html = '<a href=\"http://www.grafana.com\">Go to base</a>'\n    Get raw (numeric) value:\n      let a = value.raw\n\n    Extra objects are in scope to help the formatting:\n      field: dataframe field of this value. The field.name is most useful here.\n      context.df: whole dataframe\n      lib.moment: moment.js library, handy for the datetimes.\n*/\n\nvalue.text = field.name + ':' + value.raw\nvalue.style = {'color': 'red'}"})})),H.useFieldConfig({useCustomConfig:function(n){n.addRadio({path:"display_mode",name:"Cell display mode",settings:{options:[{value:"auto",label:"Auto"},{value:"fg",label:"Color text"},{value:"bg",label:"Color background"}]},defaultValue:"auto"})}})}])}));
//# sourceMappingURL=module.js.map